(window.webpackJsonp=window.webpackJsonp||[]).push([[1189],{1671:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.Validator=void 0;var n=c(r(284)),l=c(r(1672)),o=c(r(83));function c(e){return e&&e.__esModule?e:{default:e}}var d={install:function(){o.default.reg("valid"),n.default.mixins.push(l.default)}};t.Validator=d;var f=d;t.default=f},1672:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=h(r(41)),l=h(r(83)),o=h(r(61)),c=r(253),d=r(64),f=(r(108),h(r(102)));function h(e){return e&&e.__esModule?e:{default:e}}function v(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function m(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var w=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Object.assign(this,{$options:t,required:t.required,min:t.min,max:t.max,type:t.type,pattern:t.pattern,validator:t.validator,trigger:t.trigger,maxWidth:t.maxWidth})}var t,r,n;return t=e,(r=[{key:"content",get:function(){return(0,d.getFuncText)(this.$options.content||this.$options.message)}},{key:"message",get:function(){return this.content}}])&&m(t.prototype,r),n&&m(t,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function y(e,t){var r=e.type,l=e.min,o=e.max,pattern=e.pattern,c="number"===r,d=c?n.default.toNumber(t):n.default.getSize(t);return!(!c||!isNaN(t))||(!n.default.eqNull(l)&&d<n.default.toNumber(l)||(!n.default.eqNull(o)&&d>n.default.toNumber(o)||!(!pattern||(n.default.isRegExp(pattern)?pattern:new RegExp(pattern)).test(t))))}var E={methods:{_fullValidate:function(e,t){return this.beginValidate(e,t,!0)},_validate:function(e,t){return this.beginValidate(e,t)},handleValidError:function(e){var t=this,r=this.validOpts;return new Promise((function(n){!1===r.autoPos?(t.emitEvent("valid-error",e),n()):t.handleActived(e,{type:"valid-error",trigger:"call"}).then((function(){setTimeout((function(){n(t.showValidTooltip(e))}),10)}))}))},handleErrMsgMode:function(e){if("single"===this.validOpts.msgMode){var t=Object.keys(e),r=e;if(t.length){var n=t[0];r[n]=e[n]}return r}return e},beginValidate:function(e,t,r){var l,d=this,h={},v=this.editRules,m=this.afterFullData,w=this.visibleColumn,y=this.treeConfig,E=this.treeOpts,R=E.children||E.childrenField;!0===e?l=m:e&&(n.default.isFunction(e)?t=e:l=n.default.isArray(e)?e:[e]),l||(l=this.getInsertRecords().concat(this.getUpdateRecords()));var x=[];this.lastCallTime=Date.now(),this.validRuleErr=!1,this.clearValidate();var M={};if(v){var O=this.getColumns(),V=function(e){if(r||!d.validRuleErr){var t=[];O.forEach((function(l){!r&&d.validRuleErr||!n.default.has(v,l.property)||t.push(d.validCellRules("all",e,l).catch((function(t){var n=t.rule,o={rule:n,rules:t.rules,rowIndex:d.getRowIndex(e),row:e,columnIndex:d.getColumnIndex(l),column:l,field:l.property,$table:d};if(h[l.property]||(h[l.property]=[]),M["".concat((0,c.getRowid)(d,e),":").concat(l.id)]={column:l,row:e,rule:n,content:n.content},h[l.property].push(o),!r)return d.validRuleErr=!0,Promise.reject(o)})))})),x.push(Promise.all(t))}};return y?n.default.eachTree(l,V,{children:R}):l.forEach(V),Promise.all(x).then((function(){var e=Object.keys(h);return d.validErrorMaps=d.handleErrMsgMode(M),d.$nextTick().then((function(){if(e.length)return Promise.reject(h[e[0]][0]);t&&t()}))})).catch((function(e){return new Promise((function(r,n){var l=function(){d.$nextTick((function(){t?(t(h),r()):"obsolete"===o.default.validToReject?n(h):r(h)}))};if(!1===d.validOpts.autoPos)l();else{var c=e.row,v=e.column,y=m.indexOf(c),E=w.indexOf(v),R=y>0?m[y-1]:c,x=E>0?w[y-1]:v;d.scrollToRow(R,x).then((function(){e.cell=d.getCell(e.row,e.column),f.default.scrollToView(e.cell),d.handleValidError(e).then(l)}))}}))}))}return this.validErrorMaps={},this.$nextTick().then((function(){t&&t()}))},hasCellRules:function(e,t,r){var l=this.editRules,o=r.property;if(o&&l){var c=n.default.get(l,o);return c&&n.default.find(c,(function(t){return"all"===e||!t.trigger||e===t.trigger}))}return!1},validCellRules:function(e,t,r,o){var c=this,f=this.editRules,h=r.property,v=[],m=[];if(h&&f){var E=n.default.get(f,h);if(E){var R=n.default.isUndefined(o)?n.default.get(t,h):o;E.forEach((function(o){var f=o.type,h=o.trigger,x=o.required,M=o.validator;if("all"===e||!h||e===h)if(M){var O,V={cellValue:R,rule:o,rules:E,row:t,rowIndex:c.getRowIndex(t),column:r,columnIndex:c.getColumnIndex(r),field:r.property,$table:c};if(n.default.isString(M)){var T=l.default.validators.get(M);T&&T.cellValidatorMethod&&(O=T.cellValidatorMethod(V))}else O=M(V);O&&(n.default.isError(O)?(c.validRuleErr=!0,v.push(new w({type:"custom",trigger:h,content:O.message,rule:new w(o)}))):O.catch&&m.push(O.catch((function(e){c.validRuleErr=!0,v.push(new w({type:"custom",trigger:h,content:e&&e.message?e.message:o.content||o.message,rule:new w(o)}))}))))}else{var P="array"===f,j=n.default.isArray(R),C=!0;C=P||j?!j||!R.length:n.default.isString(R)?(0,d.eqEmptyValue)(R.trim()):(0,d.eqEmptyValue)(R),(x?C||y(o,R):!C&&y(o,R))&&(c.validRuleErr=!0,v.push(new w(o)))}}))}}return Promise.all(m).then((function(){if(v.length){var e={rules:v,rule:v[0]};return Promise.reject(e)}}))},_clearValidate:function(e,t){var r=this,l=this.validOpts,o=this.validErrorMaps,d=this.$refs.validTip,f=n.default.isArray(e)?e:e?[e]:[],h=n.default.isArray(t)?t:(t?[t]:[]).map((function(e){return(0,c.handleFieldOrColumn)(r,e)})),v={};if(d&&d.reactData.visible&&d.close(),"single"===l.msgMode)return this.validErrorMaps={},this.$nextTick();if(f.length&&h.length)v=Object.assign({},o),f.forEach((function(e){h.forEach((function(t){var n="".concat((0,c.getRowid)(r,e),":").concat(t.id);v[n]&&delete v[n]}))}));else if(f.length){var m=f.map((function(e){return"".concat((0,c.getRowid)(r,e))}));n.default.each(o,(function(e,t){m.indexOf(t.split(":")[0])>-1&&(v[t]=e)}))}else if(h.length){var w=h.map((function(e){return"".concat(e.id)}));n.default.each(o,(function(e,t){w.indexOf(t.split(":")[1])>-1&&(v[t]=e)}))}return this.validErrorMaps=v,this.$nextTick()},triggerValidate:function(e){var t=this,r=this.editConfig,n=this.editStore,l=this.editRules,o=this.editOpts,c=this.validOpts,d=n.actived;if(l&&"single"===c.msgMode&&(this.validErrorMaps={}),r&&l&&d.row){var f=d.args,h=f.row,v=f.column,m=f.cell;if(this.hasCellRules(e,h,v))return this.validCellRules(e,h,v).then((function(){"row"===o.mode&&t.clearValidate(h,v)})).catch((function(r){var n=r.rule;if(!n.trigger||e===n.trigger){var l={rule:n,row:h,column:v,cell:m};return t.showValidTooltip(l),Promise.reject(l)}return Promise.resolve()}))}return Promise.resolve()},showValidTooltip:function(e){var t=this.$refs,r=this.height,n=this.validStore,l=this.validErrorMaps,o=this.tableData,d=this.validOpts,f=e.rule,h=e.row,m=e.column,w=e.cell,y=t.validTip,content=f.content;return n.visible=!0,"single"===d.msgMode?this.validErrorMaps=v({},"".concat((0,c.getRowid)(this,h),":").concat(m.id),{column:m,row:h,rule:f,content:content}):this.validErrorMaps=Object.assign({},l,v({},"".concat((0,c.getRowid)(this,h),":").concat(m.id),{column:m,row:h,rule:f,content:content})),this.emitEvent("valid-error",e,null),y&&y&&("tooltip"===d.message||"default"===d.message&&!r&&o.length<2)?y.open(w,content):this.$nextTick()}}};t.default=E}}]);