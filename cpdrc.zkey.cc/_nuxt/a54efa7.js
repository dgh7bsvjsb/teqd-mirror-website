(window.webpackJsonp=window.webpackJsonp||[]).push([[542],{1016:function(t,e,n){"use strict";n.r(e);var o={data:function(){return{options:{}}},mounted:function(){},methods:{}},r=(n(1424),n(10)),component=Object(r.a)(o,(function(){return(0,this._self._c)("div",{staticClass:"extend-act-box"})}),[],!1,null,"22fd747a",null);e.default=component.exports},1125:function(t,e,n){"use strict";n.r(e);n(67),n(132),n(63),n(76),n(72);var o={data:function(){var t=this;return{propertyEditors:{url:this.dictionary},dictionaryUrl:"/apiSurvey/dictionary/find/",dictionaryModal:{show:!1,model:{},data:{},table:[]},dictionaryProps:{checkStrictly:!0,lazy:!0,lazyLoad:function(e,n){var o=e.level;if(0==o)return n([{value:"systemList",label:"系统数据字典",disabled:!0},{value:"customList",label:"自定义数据字典",disabled:!0}]);t.$axios({method:"post",url:"project/dictionary/"+e.path[0],data:{descendants:!1,pageIndex:-1,path:o>1?e.value:void 0}}).then((function(e){return e.resultStatus?n((e.result.content||[]).map((function(t){return{value:t.path+t.value,label:"".concat(t.title||t.value)}}))):(t.$message.error(e.message),n([]))})).catch((function(e){return console.log(e),t.$message.error("数据请求失败"),n([])}))}}}},mounted:function(){},methods:{dictionary:function(t){this.dictionaryModal.show=!0,this.dictionaryModal.model=t.model,this.$set(this.dictionaryModal.data,"dictionary",[]);var e=t.model.object.url;if(e&&e.startsWith(this.dictionaryUrl)){var path=e.replace(this.dictionaryUrl,""),n=path.split(":");if(path.startsWith(":PLAT_FORM_DICTIONARY:")){this.dictionaryModal.data.dictionary.push("systemList");for(var i=2;i<n.length;i++)this.dictionaryModal.data.dictionary.push(n.slice(0,i+1).join(":"))}else{this.dictionaryModal.data.dictionary.push("customList");for(i=3;i<n.length;i++)this.dictionaryModal.data.dictionary.push(n.slice(0,i+1).join(":"))}this.changeDictionary(this.dictionaryModal.data.dictionary)}},confirmDictionary:function(){var t=this;this.$refs.dictionary.validate((function(e){if(!e)return console.log("error submit!!"),!1;var n=t.dictionaryModal.model,o=t.dictionaryModal.data.dictionary[t.dictionaryModal.data.dictionary.length-1];n.object.url=t.dictionaryUrl+o,t.dictionaryModal.show=!1}))},changeDictionary:function(t){var e=this;!t||t.length<2?this.dictionaryModal.table=[]:this.$axios({method:"post",url:"project/dictionary/"+t[0],data:{descendants:!1,path:t[t.length-1],pageIndex:-1}}).then((function(t){t.resultStatus?e.dictionaryModal.table=t.result.content||[]:(e.dictionaryModal.table=[],e.$message.error(t.message))})).catch((function(t){console.log(t),e.$message.error("数据请求失败"),e.dictionaryModal.table=[]}))},loadChildren:function(t,e,n){var o=this,r=this.dictionaryModal.data.dictionary;this.$axios({method:"post",url:"project/dictionary/"+r[0],data:{descendants:!1,pid:t.id,pageIndex:-1}}).then((function(e){if(e.resultStatus){for(var r=[],i=0;i<e.result.content.length;i++)r.push(Object.assign({parentId:t.id},e.result.content[i]));n(r)}else n([]),o.$message.error(e.message)})).catch((function(t){console.log(t),n([])}))},goto:function(path){window.open(path)},close:function(){this.$destroy(!0),this.$el.parentNode.removeChild(this.$el)}}},r=(n(1422),n(10)),component=Object(r.a)(o,(function(){var t=this,e=t._self._c;return e("div",{attrs:{id:"survey_property_editor"}},[e("el-dialog",{attrs:{"append-to-body":"",title:"选择数据字典",visible:t.dictionaryModal.show,top:"5vh",width:"900px","custom-class":"small-padding-modal","destroy-on-close":""},on:{"update:visible":function(e){return t.$set(t.dictionaryModal,"show",e)},close:t.close}},[e("el-form",{ref:"dictionary",attrs:{size:"small",model:t.dictionaryModal.data,"label-width":"80px"}},[e("div",{staticClass:"btn-box"},[e("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(e){return t.goto("/project/customDictionary")}}},[t._v("添加数据字典")])],1),t._v(" "),e("el-form-item",{attrs:{label:"数据字典",prop:"dictionary",rules:[{required:!0,message:"请选择数据字典"}]}},[e("el-cascader",{staticStyle:{width:"100%"},attrs:{props:t.dictionaryProps,clearable:""},on:{change:t.changeDictionary},model:{value:t.dictionaryModal.data.dictionary,callback:function(e){t.$set(t.dictionaryModal.data,"dictionary",e)},expression:"dictionaryModal.data.dictionary"}})],1),t._v(" "),e("el-table",{ref:"table",staticStyle:{width:"100%"},attrs:{data:t.dictionaryModal.table,size:"small",stripe:"",border:"","row-key":"id",lazy:"",load:t.loadChildren,height:"300px"}},[e("el-table-column",{attrs:{prop:"value",label:"值","min-width":"100","header-align":"center"}}),t._v(" "),e("el-table-column",{attrs:{prop:"title",label:"值标签",align:"center","min-width":"100"}})],1)],1),t._v(" "),e("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(e){return t.confirmDictionary()}}},[t._v("确定")]),t._v(" "),e("el-button",{attrs:{size:"small"},on:{click:function(e){t.dictionaryModal.show=!1}}},[t._v("取消")])],1)],1)],1)}),[],!1,null,"1d7988ae",null);e.default=component.exports},1422:function(t,e,n){"use strict";n(865)},1423:function(t,e,n){var o=n(15)((function(i){return i[1]}));o.push([t.i,".btn-box[data-v-1d7988ae]{margin-bottom:20px}",""]),o.locals={},t.exports=o},1424:function(t,e,n){"use strict";n(866)},1425:function(t,e,n){var o=n(15)((function(i){return i[1]}));o.push([t.i,".extend-act-box[data-v-22fd747a]{height:0;overflow:hidden;width:0}",""]),o.locals={},t.exports=o},1432:function(t,e,n){"use strict";n(870)},1433:function(t,e,n){var o=n(15)((function(i){return i[1]}));o.push([t.i,".extend-act-box[data-v-67f1d304]{height:0;overflow:hidden;width:0}",""]),o.locals={},t.exports=o},1436:function(t,e,n){"use strict";n(872)},1437:function(t,e,n){var o=n(15)((function(i){return i[1]}));o.push([t.i,".question-select.sv_main .sv_p_root .sv_row .sv_q.sv_qstn:first-child:last-child{flex:1!important}",""]),o.locals={},t.exports=o},1438:function(t,e,n){"use strict";n(873)},1439:function(t,e,n){var o=n(15)((function(i){return i[1]}));o.push([t.i,'.question-select[data-v-0797d869]{display:flex;flex-direction:column}.question-select>.sv_container[data-v-0797d869]{background-color:#fff;flex:1;height:0!important}.survey-title[data-v-0797d869]{color:#000;font-size:24px;text-align:center}.survey-description[data-v-0797d869]{margin-top:10px}.survey-view-box[data-v-0797d869]{height:0;overflow:hidden;width:100%}.survey-content[data-v-0797d869],.survey-content .sv_container[data-v-0797d869]{height:100%}.sv_main.sv_default_css .sv_container[data-v-0797d869]{margin-bottom:0}.survey-content .sv_body[data-v-0797d869]{display:flex;flex-direction:column;height:100%}.check-all-box[data-v-0797d869]{border-bottom:1px dashed #e4e4e4;margin-bottom:10px;margin-top:30px;padding-bottom:5px;padding-left:15px}.survey-content .question-list-box[data-v-0797d869]{flex:1;height:0;overflow:auto}.checkbox-item[data-v-0797d869]{display:flex;margin-right:0;padding:15px}.checkbox-item[data-v-0797d869]:hover{background-color:rgba(102,16,176,.03)}.checkbox-item[data-v-0797d869] .el-checkbox__label{flex:1;margin-right:10px;overflow:auto;width:0}.checkbox-item[data-v-0797d869] .el-checkbox__input{margin-top:10px}.question-item[data-v-0797d869] .sv_qcbc{white-space:normal}.question-item[data-v-0797d869]{position:relative;white-space:normal}.question-item[data-v-0797d869]:after{background-color:transparent;bottom:0;content:"";display:block;left:0;position:absolute;right:0;top:0;z-index:1}.survey-content[data-v-0797d869]{background:transparent none repeat 0 0/auto auto padding-box border-box scroll!important;background:initial!important}.survey-content[data-v-0797d869],.survey-content .sv_body[data-v-0797d869],.survey-content .sv_container[data-v-0797d869]{padding:0!important}',""]),o.locals={},t.exports=o},1440:function(t,e,n){"use strict";n(874)},1441:function(t,e,n){var o=n(15)((function(i){return i[1]}));o.push([t.i,".ai-survey-modal .el-dialog__body,.ai-survey-modal .el-dialog__header{padding:0}.ai-survey-modal .el-dialog__headerbtn{z-index:2100}.ai-survey-modal .survey-content .sv_container{padding:30px!important}.ai-survey-modal .ai-survey-form .el-form-item__label{padding-bottom:0}",""]),o.locals={},t.exports=o},1442:function(t,e,n){"use strict";n(875)},1443:function(t,e,n){var o=n(15)((function(i){return i[1]}));o.push([t.i,".extend-act-box[data-v-1ccadeb3]{height:0;overflow:hidden;width:0}.ai-survey-box[data-v-1ccadeb3]{display:flex;height:90vh}.ai-survey-box[data-v-1ccadeb3] .ai-form-content{flex:1;height:0}.ai-form-act[data-v-1ccadeb3]{text-align:center}.ai-form-act .ai-submit-btn[data-v-1ccadeb3]{background:linear-gradient(245deg,#5a55ff,#6460ed 0,#797eff 17%,#4e8dff 48%,#93baff 82%,#a495ff);width:100%}.ai-form-act .ai-submit-btn[data-v-1ccadeb3]:hover:not(:active){opacity:.8}.ai-survey-form[data-v-1ccadeb3]{border-right:1px solid #eee;display:flex;flex-direction:column;padding:24px;position:relative;width:420px}.ai-form-title[data-v-1ccadeb3]{color:#000;font-size:18px}.ai-form-title>img[data-v-1ccadeb3]{height:40px;margin-right:10px}.structures-content[data-v-1ccadeb3]{background-color:#f7fafb;padding:10px 0 10px 10px}.structures-list[data-v-1ccadeb3]{display:flex;flex-direction:column;max-height:200px}.structures-list>.scrollbar_y[data-v-1ccadeb3]{display:flex;flex:1;flex-direction:column;padding-bottom:15px}.link-btn[data-v-1ccadeb3]{-webkit-text-decoration:underline;text-decoration:underline}.tips-icon[data-v-1ccadeb3]{color:#666;cursor:pointer;font-size:16px;vertical-align:bottom}.ai-survey-view[data-v-1ccadeb3]{background-color:#f7fafb;display:flex;flex:1;flex-direction:column;overflow:auto;padding:30px 45px 24px}.ai-survey-view[data-v-1ccadeb3] .z-main{height:100%}.ai-survey-view[data-v-1ccadeb3] .z-main .zk_bx{width:700px}.ai-survey-view .ai-view-tips[data-v-1ccadeb3]{color:#999;float:left;font-size:12px;margin:11px 0}.ai-view-title[data-v-1ccadeb3]{color:#000;font-size:18px;font-weight:700}.ai-view-content[data-v-1ccadeb3]{flex:1;height:0;margin:10px 0;position:relative}.ai-view-act[data-v-1ccadeb3]{text-align:right}.question-box[data-v-1ccadeb3]{height:100%}.question-box-next-loading[data-v-1ccadeb3]{display:inline-block;margin-right:15px}.question-box-next-loading img[data-v-1ccadeb3]{width:35px}.empty-box[data-v-1ccadeb3]{left:50%;position:absolute;top:50%;transform:translate(-50%,-50%)}.structures-item-box[data-v-1ccadeb3]{align-items:center;display:flex}.structures-item-box+.structures-item-box[data-v-1ccadeb3]{margin-top:10px}.structures-item[data-v-1ccadeb3]{display:block}.structures-item-box .structures-btn[data-v-1ccadeb3]{display:none;font-size:16px;margin:0 2px;padding:0}.structures-item-box:hover .structures-btn[data-v-1ccadeb3]{display:inline-block}.structures-item-act[data-v-1ccadeb3]{align-items:center;display:flex;flex:1;padding-left:5px}.structures-btn[data-v-1ccadeb3]:hover:not(:active){font-size:18px;margin:0 1px}.ai-loading-box[data-v-1ccadeb3]{background-color:hsla(0,0%,100%,.9);bottom:0;left:0;position:absolute;right:0;top:0;z-index:2}.ai-loading[data-v-1ccadeb3]{color:#409eff;left:50%;position:absolute;text-align:center;top:50%;transform:translate(-50%,-50%)}.ai-loading>img[data-v-1ccadeb3]{height:120px;margin-bottom:10px}.ai-form-content[data-v-1ccadeb3] .el-form-item__label{display:block}.structures-item[data-v-1ccadeb3] .el-input__suffix{height:100%}",""]),o.locals={},t.exports=o},1446:function(t,e,n){"use strict";n(878)},1447:function(t,e,n){var o=n(15)((function(i){return i[1]}));o.push([t.i,".extend-act-box[data-v-e344d546]{height:0;overflow:hidden;width:0}",""]),o.locals={},t.exports=o},1448:function(t,e,n){"use strict";n(879)},1449:function(t,e,n){var o=n(15)((function(i){return i[1]}));o.push([t.i,".help-text-icon[data-v-3639da4c]{cursor:pointer}.function-item+.function-item[data-v-3639da4c]{margin-top:20px}.function-name[data-v-3639da4c]{font-size:20px;font-weight:700}.function-item>div[data-v-3639da4c]{margin-bottom:5px}",""]),o.locals={},t.exports=o},1510:function(t,e,n){"use strict";n(906)},1511:function(t,e,n){var o=n(15)((function(i){return i[1]}));o.push([t.i,".varlist-box[data-v-75e921b4]{position:relative}.shift-icon[data-v-75e921b4]{border-radius:2px;cursor:pointer;font-size:12px;line-height:1;padding:1px;position:absolute;right:20px;top:5px;z-index:10}.download-item[data-v-75e921b4]{align-items:center;border:1px solid transparent;display:flex;margin-right:0;padding:2px 0 4px 5px}.download-item[data-v-75e921b4] .el-checkbox__input{height:14px}.download-item[data-v-75e921b4] .el-checkbox__label{flex:1;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.download-item.shift-active[data-v-75e921b4]{border:1px dotted #ccc}.search-input[data-v-75e921b4],.tool-btn+.tool-btn[data-v-75e921b4]{margin-left:2px}.search-input[data-v-75e921b4]{width:270px}",""]),o.locals={},t.exports=o},1540:function(t,e,n){"use strict";n(921)},1541:function(t,e,n){var o=n(15)((function(i){return i[1]}));o.push([t.i,".sv_main .sv_custom_header{background-color:transparent}.sv_main form .sv_container{margin:0 auto;max-width:1200px}.sv_main .sv_custom_header{position:inherit}",""]),o.locals={},t.exports=o},1542:function(t,e,n){"use strict";n(922)},1543:function(t,e,n){var o=n(15)((function(i){return i[1]}));o.push([t.i,".survey-view-box[data-v-2b49454a]{display:flex;flex-direction:column;height:100%;position:relative}.survey-box[data-v-2b49454a]{bottom:0;left:0;position:absolute;right:0;top:36px}.survey-element[data-v-2b49454a]{height:100%;overflow-y:auto}.survey-act-box[data-v-2b49454a]{height:33px;overflow:hidden;position:absolute;right:20px;top:20px;transition:.5s;width:200px;z-index:9999}.survey-btn-box[data-v-2b49454a]{position:absolute;right:0;text-align:right;top:0;width:200px}.survey-act-box.hide-act[data-v-2b49454a]{width:35px}.survey-act-box[data-v-2b49454a] .el-button+.el-button{margin-left:2px}",""]),o.locals={},t.exports=o},339:function(t,e,n){"use strict";n.r(e),n.d(e,"textImport",(function(){return v})),n.d(e,"templateChoose",(function(){return f})),n.d(e,"aiSurvey",(function(){return m})),n.d(e,"helpText",(function(){return y}));n(50),n(159);var o=n(7),r=n.n(o),l=(n(1016),n(752)),c=n(753),d=n(754),h=n(755);function v(t){return new Promise((function(e,n){var o=new(r.a.extend(l.default))({data:{options:t,resolve:function(t){c(),e(t)},reject:function(t){c(),n(t)}}});function c(){o.$destroy(!0),o.$el.parentNode.removeChild(o.$el)}o.$mount(),document.body.appendChild(o.$el)}))}function f(t){return new Promise((function(e,n){var o=new(r.a.extend(d.default))({data:{options:t,resolve:function(t){l(),e(t)},reject:function(t){l(),n(t)}}});function l(){o.$destroy(!0),o.$el.parentNode.removeChild(o.$el)}o.$store=t.$store,o.$mount(),document.body.appendChild(o.$el)}))}function m(t){var e=this;return new Promise((function(n,o){var l=new(r.a.extend(c.default))({data:{vueExp:e,options:t||{},resolve:function(t){d(),n(t)},reject:function(t){d(),o(t)}}});function d(){l.$destroy(!0),l.$el.parentNode.removeChild(l.$el)}l.$mount(),document.body.appendChild(l.$el)}))}function y(t){var element=t.element||t.elements&&t.elements.length&&t.elements[0];if(element){var e=$(element).parent().find(".vue-help-text");if(0!=e.length){var n=new(r.a.extend(h.default))({data:{model:t}});n.$mount(),e.html(n.$el)}}}},715:function(t,e,n){"use strict";n.r(e);n(132),n(63),n(48);var o=n(7),r=n.n(o);n(1125),n(31);e.default=function(t,e){"url"==t.model.property.name&&function(t){var e="/apiSurvey/dictionary/find/",n=t.model.object.url;n&&n.startsWith(e)&&(n=n.replace(e,"")),r.a.prototype.selectDictionary({defaultDictionary:n}).then((function(n){t.model.object.url=n?e+n:""})).catch((function(t){}))}(t)}},722:function(t,e,n){"use strict";n.r(e);n(67),n(97),n(60),n(46);var o={props:{value:[],title:String,varList:Array},data:function(){return{isShift:!1,shiftSign:!1,shiftId:"",searchText:"",modal:{show:!1,list:[]}}},computed:{variableList:function(){return this.varList.map((function(t){return Object.assign({},t,{label:"".concat(t.varLabel||"","[").concat(t.varName,"]")})}))},filterVarList:function(){var t=this;return this.variableList.filter((function(e){return-1!=e.label.indexOf(t.searchText)}))}},mounted:function(){var t=this;$(document).keydown((function(e){16==e.keyCode&&(t.isShift=!0)})),$(document).keyup((function(e){16==e.keyCode&&(t.isShift=!1)}))},methods:{openModal:function(){var t=this;this.modal={show:!0,list:JSON.parse(JSON.stringify(this.value||[]))},this.$nextTick((function(){t.$refs.varList&&t.$refs.varList.refreshScroll&&t.$refs.varList.refreshScroll()}))},checkedChange:function(t,e,n){if(this.isShift&&this.shiftId&&this.shiftId!=n.id){var o,r,l=this.filterVarList.map((function(t){return t.id})),c=l.indexOf(this.shiftId);c>(h=l.indexOf(n.id))?(r=c,o=h):(o=c,r=h);for(var d=[],i=o;i<r+1;i++)d.push(this.variableList[i]);for(i=0;i<d.length;i++)if(this.setShow){if(this.shiftSign&&!this.defaultList.includes(d[i].varName))this.defaultList.push(d[i].varName);else if(!this.shiftSign&&this.defaultList.includes(d[i].varName)){var h=this.defaultList.indexOf(d[i].varName);this.defaultList.splice(h,1)}}else if(this.shiftSign&&!this.modal.list.includes(d[i].varName))this.modal.list.push(d[i].varName);else if(!this.shiftSign&&this.modal.list.includes(d[i].varName)){h=this.modal.list.indexOf(d[i].varName);this.modal.list.splice(h,1)}}else this.shiftId=n.id,this.shiftSign=t},selectAll:function(){this.modal.list=[];for(var i=0;i<this.variableList.length;i++)this.modal.list.push(this.variableList[i].varName)},cancelAll:function(){this.modal.list=[]},inverse:function(){for(var t=[],i=0;i<this.variableList.length;i++)this.modal.list.includes(this.variableList[i].varName)||t.push(this.variableList[i].varName);this.modal.list=t},submit:function(){var t=this;this.$confirm("是否确认提交配置","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){t.$emit("input",t.modal.list),t.$nextTick((function(){t.$emit("change",t.modal.list)})),t.modal.show=!1})).catch((function(){t.$message.info("已取消")}))}},watch:{searchText:function(t,e){var n=this;this.$nextTick((function(){var t=n.filterVarList.map((function(t){return t.id}));n.shiftId&&!t.includes(n.shiftId)&&(n.shiftId=""),n.$refs.varList&&n.$refs.varList.refreshScroll&&n.$refs.varList.refreshScroll()}))}}},r=(n(1510),n(10)),component=Object(r.a)(o,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"select-content"},[t._t("default"),t._v(" "),e("el-dialog",{attrs:{title:t.title||"选择变量",visible:t.modal.show,width:"700px",top:"5vh","append-to-body":"","custom-class":"small-padding-modal"},on:{"update:visible":function(e){return t.$set(t.modal,"show",e)}}},[e("div",{staticClass:"modal-box"},[e("div",{staticStyle:{"margin-bottom":"10px"}},[e("el-button",{staticClass:"tool-btn",attrs:{size:"minimum",type:"primary",icon:"el-icon-check",title:"全选"},on:{click:function(e){return t.selectAll()}}}),t._v(" "),e("el-button",{staticClass:"tool-btn",attrs:{size:"minimum",type:"primary",icon:"el-icon-close",title:"全不选"},on:{click:function(e){return t.cancelAll()}}}),t._v(" "),e("el-button",{staticClass:"tool-btn",attrs:{size:"minimum",type:"primary",icon:"el-icon-sort",title:"反选"},on:{click:function(e){return t.inverse()}}}),t._v(" "),e("el-input",{staticClass:"search-input",attrs:{size:"minimum",placeholder:"请输入关键词搜索"},model:{value:t.searchText,callback:function(e){t.searchText=e},expression:"searchText"}},[e("el-button",{attrs:{slot:"append",size:"minimum",icon:"el-icon-search"},slot:"append"})],1),t._v(" "),e("span",{staticStyle:{float:"right",color:"#aaa"}},[t._v(t._s(t.modal.list.length)+"/"+t._s(t.filterVarList.length))])],1),t._v(" "),e("div",{ref:"varListBox",staticClass:"varlist-box"},[e("vxe-list",{ref:"varList",attrs:{height:"calc(90vh - 170px)",data:t.filterVarList,"auto-resize":"","scroll-y":{enabled:!0,sItem:".download-item-box"}},scopedSlots:t._u([{key:"default",fn:function(n){var o=n.items;return[e("el-checkbox-group",{staticStyle:{padding:"10px 0"},model:{value:t.modal.list,callback:function(e){t.$set(t.modal,"list",e)},expression:"modal.list"}},t._l(o,(function(i,n){return e("div",{key:i.id,staticClass:"download-item-box",attrs:{title:i.label}},[e("el-checkbox",{staticClass:"download-item",class:{"shift-active":t.shiftId==i.id},attrs:{label:i.varName},on:{change:function(e,n){t.checkedChange(e,n,i)}}},[e("span",{domProps:{innerHTML:t._s(i.label)}})])],1)})),0)]}}])})],1)]),t._v(" "),e("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(e){return t.submit()}}},[t._v("确定")]),t._v(" "),e("el-button",{attrs:{size:"small"},on:{click:function(e){t.modal.show=!1}}},[t._v("取消")])],1)])],2)}),[],!1,null,"75e921b4",null);e.default=component.exports},724:function(t,e,n){"use strict";n.r(e);n(48),n(159);var o={name:"questionSelect",props:{json:Object,disabled:Boolean,value:{type:Array,default:function(){return[]}}},data:function(){return{showView:!0,list:this.value,checkAll:!1}},computed:{questionList:function(){for(var t=[],e=this.json.pages||[],i=0;i<e.length;i++)if(e[i].elements)for(var n=0;n<e[i].elements.length;n++)t.push(o(e[i].elements[n]));function o(t){var e=t;return delete e.visible,delete e.visibleIf,e.startWithNewLine=!0,e}return t},handledJSON:function(){return Object.assign({},this.json,{pages:[{name:"Page1",elements:this.questionList}]})},isIndeterminate:function(){return this.list.length>0&&this.questionList.length>0&&this.list.length!=this.questionList.length}},mounted:function(){this.showQuestion()},methods:{handleCheckAllChange:function(t){this.list=t?this.questionList:[],this.handleCheckedCitiesChange(this.list)},handleCheckedCitiesChange:function(t){var e=t.length;this.checkAll=e===this.questionList.length},showQuestion:function(){var t=this;setTimeout((function(){t.handleQuestionList()}))},handleQuestionList:function(){for(var i=0;i<this.questionList.length;i++){this.questionList[i];var t=".sv_row:not(.question-item) .sv_q[data-name=".concat(this.questionList[i].name,"], .sd-row:not(.question-item) .sd-question[data-name=").concat(this.questionList[i].name,"], .sd-row:not(.question-item) .sv_q[data-name=").concat(this.questionList[i].name,"]"),element=$(this.$refs.view).find(t).detach();element&&element.length&&$(this.$refs["q"+i]).html(element)}var template,link=$(this.$refs.view).find(".sv_container>link,.sd-container-modern>link").detach(),style=$(this.$refs.view).find(".sv_container>style,.sd-container-modern>style").detach();link&&link.length&&(0==(template=$(this.$refs.style).find("link")).length&&$(this.$refs.style).append(link));style&&style.length&&(0==(template=$(this.$refs.style).find("style")).length?$(this.$refs.style).append(style):template.replaceWith(style))}},watch:{json:{deep:!0,handler:function(t,e){this.handleQuestionList()}},value:function(t,e){JSON.stringify(t)!=JSON.stringify(this.list)&&(this.list=JSON.parse(JSON.stringify(t)))},list:function(t,e){this.$emit("input",t)}}},r=(n(1436),n(1438),n(10)),component=Object(r.a)(o,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"question-select survey-content sv_main z-main sv_default_css"},[e("div",{staticClass:"sv_container"},[e("div",{staticClass:"sv_body"},[t.json.title?e("div",{staticClass:"survey-title",domProps:{innerHTML:t._s(t.json.title)}}):t._e(),t._v(" "),t.json.description?e("div",{staticClass:"survey-description",domProps:{innerHTML:t._s(t.json.description)}}):t._e(),t._v(" "),e("div",{staticClass:"check-all-box"},[e("el-checkbox",{attrs:{disabled:t.disabled,indeterminate:t.isIndeterminate},on:{change:t.handleCheckAllChange},model:{value:t.checkAll,callback:function(e){t.checkAll=e},expression:"checkAll"}},[t._v("全选")]),t._v(" "),t.list.length?e("span",{staticStyle:{color:"#999"}},[t._v("（已选\n          "),e("strong",{staticStyle:{color:"#0066ff"}},[t._v(t._s(t.list.length))]),t._v("\n          道题）")]):t._e()],1),t._v(" "),e("div",{ref:"question",staticClass:"question-list-box sv_p_root"},[e("el-scrollbar",{staticClass:"scrollbar_y",staticStyle:{height:"100%"}},[e("el-checkbox-group",{attrs:{disabled:t.disabled},on:{change:t.handleCheckedCitiesChange},model:{value:t.list,callback:function(e){t.list=e},expression:"list"}},t._l(t.questionList,(function(i,t){return e("el-checkbox",{key:t,staticClass:"checkbox-item",attrs:{label:i}},[e("div",{ref:"q"+t,refInFor:!0,staticClass:"sv_row question-item"})])})),1)],1)],1)])]),t._v(" "),e("div",{ref:"view",staticClass:"survey-view-box"},[t.showView?e("survey-view",{attrs:{json:t.handledJSON}}):t._e()],1),t._v(" "),e("div",{ref:"style",staticClass:"survey-view-box"})])}),[],!1,null,"0797d869",null);e.default=component.exports},751:function(t,e,n){"use strict";n.r(e);n(50),n(161),n(173);var o={props:{id:String,shortLink:String,version:String,json:Object,options:Object,projectId:String,dataSetId:String,dataId:String,_id:String},data:function(){return{loading:!1,hideAct:!1,settedData:!1,playing:!1,playingIndex:0,paused:!0,playInterval:2,survey:"",surveyKoExt:null,tempData:{},userAction:[],timer:"",answerLog:{}}},computed:{},mounted:function(){this.init()},methods:{init:function(){this.getSurvey(),this.changeSurveyCreateTheme(),this.optionsChanged()},getSurvey:function(){var t=this;this.surveyKoExt=new this.$SurveyKoExt;try{this.json?this.renderSurvey(new this.$SurveyKo.Survey(this.json)):this.shortLink?this.renderSurvey(new this.$SurveyKo.Model({surveyId:this.shortLink,surveyPostId:this.shortLink})):this.id?this.getSurveyJson(this.id).then((function(e){t.renderSurvey(new t.$SurveyKo.Model({surveyId:e.shortLink,surveyPostId:e.shortLink}))})).catch((function(t){})):this.dataSetId?this.getDataSetInfo().then((function(e){e.questionnaireId?t.getSurveyJson(e.questionnaireId).then((function(e){t.renderSurvey(new t.$SurveyKo.Model({surveyId:e.shortLink,surveyPostId:e.shortLink}))})).catch((function(t){})):t.$message.error("所选数据集不是问卷数据集，无法预览")})).catch((function(t){})):this.$message.error("参数错误，请联系管理员")}catch(t){console.error(t)}},optionsChanged:function(){this.options},changeSurveyCreateTheme:function(){if(document){var link=document.createElement("link");link.rel="stylesheet",link.type="text/css",link.href="/surveyTheme/default-show.css",$(this.$refs.element).append(link)}},renderSurvey:function(t){var e=this;this.survey=t,this.survey.render(this.$refs.element),this.surveyKoExt.init(this.survey),this.survey.render(this.$refs.element),this.$set(this.survey,"survey",this.survey),this.$nextTick((function(){e.projectId&&e.dataSetId&&(e.dataId||e._id)&&(e.dataId?e.getAnswerLog(e.dataId):e.getAnswerData(e._id).then((function(t){t.Id?e.getAnswerLog(t.Id):e.$message.error("获取数据失败，请联系管理员")})).catch((function(t){})))}))},getAnswerData:function(t){var e=this;return new Promise((function(n,o){e.loading=!0,e.$axios({method:"get",url:"/project/analysisData/findOneCaseData/".concat(e.dataSetId,"/").concat(t)}).then((function(t){e.loading=!1,t.resultStatus?n(t.result||{}):(e.$message.error(t.message),o(t))})).catch((function(t){e.loading=!1,console.error(t),o(t)}))}))},getSurveyJson:function(t){var e=this;return new Promise((function(n,o){e.loading=!0;var r=e.version?"/apiSurvey/questionnaire/findPublishHistoryQuestionnaire/".concat(t,"/").concat(e.version):"/apiSurvey/questionnaire/FindQuestionnaireById/".concat(t);e.$axios({method:"get",url:r}).then((function(t){e.loading=!1,t.resultStatus?n(t.result):(e.$message.error(t.message),o(t))})).catch((function(t){e.loading=!1,console.error(t),o(t)}))}))},getAnswerLog:function(t){var e=this;this.loading=!0,this.$axios({method:"post",url:"/project/analysisData/findSurveyAnswerOperateLogById/".concat(this.projectId,"/").concat(this.dataSetId,"/").concat(t)}).then((function(t){var n;(e.loading=!1,t.resultStatus)?t.result?(e.answerLog=t.result,e.userAction=(null===(n=t.result)||void 0===n||null===(n=n.operateRecord)||void 0===n?void 0:n.userAction)||[],e.userAction.length>0&&e.setDataByUserAction()):e.$message.error("未获取到答题数据"):e.$message.error(t.message)})).catch((function(t){e.loading=!1,console.error(t)}))},getDataSetInfo:function(){var t=this;return new Promise((function(e,n){t.$axios({method:"get",url:"/project/dataSet/findDataSetBaseInfo/".concat(t.dataSetId)}).then((function(o){t.loading=!1,o.resultStatus?e(o.result||{}):(t.$message.error(o.message),n(o))})).catch((function(e){t.loading=!1,console.error(e)}))}))},setDataByUserAction:function(){var t=this;this.survey.global_ShortTimeMsgTimes=0,this.survey.loadAnswerData="none",this.answerLog.zkeyUserInfo&&this.survey.setValue("zkeyUserInfo",this.answerLog.zkeyUserInfo),this.userAction.forEach((function(e){e.n&&e.v&&t.survey.setValue(e.n,e.v)})),this.settedData=!0},replay:function(){var t=this;this.loading||(this.loading=!0,this.playingIndex=0,this.survey.clear(),this.timer&&(clearTimeout(this.timer),this.timer=""),this.survey.data={},this.answerLog.zkeyUserInfo&&this.survey.setValue("zkeyUserInfo",this.answerLog.zkeyUserInfo),setTimeout((function(){t.loading=!1,t.survey.currentPageNo=0,t.playing=!0,t.paused=!1,t.timer=setTimeout((function(){t.next()}),1e3*t.playInterval)})))},pause:function(){this.paused=!this.paused,this.paused?this.timer&&(clearTimeout(this.timer),this.timer=""):this.next()},next:function(){var t=this;if(this.timer&&(clearTimeout(this.timer),this.timer=""),this.playingIndex>=this.userAction.length)this.playing=!1;else{var e,n=this.userAction[this.playingIndex],o=n.n;if(o.match(/^[\s\S]+_\d+_text$/g))o=null===(e=o.match(/^[\s\S]+(?=_\d+_text$)/g))||void 0===e?void 0:e[0];var r,l=this.survey.getQuestionByName(o);if(l)l.visible&&null!==(r=l.page)&&void 0!==r&&r.visible?(this.survey.currentPageNo=l.page.visibleIndex,setTimeout((function(){var e=$(".sv_q[data-name=".concat(o,"]"));e.length>0?((e=e[0]).scrollIntoView?e.scrollIntoView():$(".survey-element#surveyElement").scrollTop($(e).offset().top-$(".survey-element#surveyElement").offset().top+$(".survey-element#surveyElement").scrollTop()-20),setTimeout((function(){c.call(t,n)}),100)):(t.$message.error("未找到题目".concat(o)),c.call(t,n))}))):(this.$message.error("题目".concat(o,"不可见")),c.call(this,n));else this.$message.error("未找到题目".concat(o,"，可能与问卷版本有关")),c.call(this,n)}function c(t){var e=this;if(this.survey.setValue(t.n,t.v),this.playingIndex++,this.playingIndex>=this.userAction.length)return this.playing=!1,void this.$message.success("重放结束");this.paused||(this.timer=setTimeout((function(){e.next()}),1e3*this.playInterval))}},autoPlaySetting:function(){var t=this;this.$prompt("请输入自动播放时间间隔（秒）","提示",{confirmButtonText:"确定",cancelButtonText:"取消",inputValue:this.playInterval,inputPattern:/^(([1-9][0-9]*(\.[0-9]{1,2})?)|(0\.[0-9]{1,2}))$/,inputValidator:function(t){return!(Number(t)<.1)||"时间间隔最小0.1秒"},inputErrorMessage:"请输入数字（最多两位小数）"}).then((function(e){var n=e.value;t.playInterval=n,t.$message.success("设置成功")})).catch((function(){t.$message.info("已取消")}))}},watch:{json:{handler:function(t,e){this.survey&&this.survey.fromJSON?this.survey.fromJSON(t):this.getSurvey()},deep:!0},options:{handler:function(t,e){this.optionsChanged()},deep:!0}},beforeDestroy:function(){this.timer&&(clearTimeout(this.timer),this.timer="")}},r=(n(1540),n(1542),n(10)),component=Object(r.a)(o,(function(){var t=this,e=t._self._c;return e("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"survey-view-box"},[e("el-alert",{attrs:{title:"此版本仅限预览，所填数据不会保存",type:"info",center:"","show-icon":""}}),t._v(" "),e("div",{staticClass:"survey-box"},[e("div",{ref:"element",staticClass:"survey-element",attrs:{id:"surveyElement"}}),t._v(" "),t.settedData?e("div",{staticClass:"survey-act-box",class:{"hide-act":t.hideAct}},[e("div",{staticClass:"survey-btn-box"},[e("el-button",{attrs:{icon:"el-icon-refresh-left",title:"重放",circle:"",size:"small"},on:{click:function(e){return t.replay()}}}),t._v(" "),e("el-button",{attrs:{icon:t.paused?"el-icon-video-play":"el-icon-video-pause",title:t.paused?"继续播放":"暂停",circle:"",size:"small",disabled:!t.playing},on:{click:function(e){return t.pause()}}}),t._v(" "),e("el-button",{attrs:{icon:"el-icon-setting",title:"自动播放间隔设置",circle:"",size:"small"},on:{click:function(e){return t.autoPlaySetting()}}}),t._v(" "),e("el-button",{attrs:{icon:"el-icon-right",title:"下一题",circle:"",size:"small",disabled:!t.playing},on:{click:function(e){return t.next()}}}),t._v(" "),e("el-button",{attrs:{icon:t.hideAct?"el-icon-arrow-left":"el-icon-arrow-right",title:t.hideAct?"展开":"收起",circle:"",size:"small"},on:{click:function(e){t.hideAct=!t.hideAct}}})],1)]):t._e()])],1)}),[],!1,null,"2b49454a",null);e.default=component.exports},752:function(t,e,n){"use strict";n.r(e);var o={components:{textImport:n(1101).default},data:function(){return{options:{},textImportModal:{show:!1,json:""},closed:!1}},mounted:function(){this.textImport()},methods:{textImport:function(){this.textImportModal={show:!0,json:""}},confirmTextImport:function(){var t=this;this.textImportModal.json?this.$confirm("是否确认提交文本编辑",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){t.textImportModal.show=!1,t.closed=!0,t.resolve(JSON.stringify(t.textImportModal.json)),t.$message.success("操作成功")})).catch((function(){t.$message.info("已取消")})):this.$message.error("问卷为空，请编辑后再提交")},close:function(){!this.closed&&this.reject&&this.reject()}}},r=(n(1432),n(10)),component=Object(r.a)(o,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"extend-act-box"},[e("el-dialog",{attrs:{"append-to-body":"",title:"文本编辑",visible:t.textImportModal.show,top:"5vh",width:"90%","custom-class":"small-padding-modal"},on:{"update:visible":function(e){return t.$set(t.textImportModal,"show",e)},closed:function(e){return t.close()}}},[t.textImportModal.show?e("div",{staticStyle:{height:"calc(90vh - 140px)"}},[e("textImport",{attrs:{disabledAutoSave:""},on:{change:function(e){t.textImportModal.json=e}}})],1):t._e(),t._v(" "),e("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(e){return t.confirmTextImport()}}},[t._v("确定")]),t._v(" "),e("el-button",{attrs:{size:"small"},on:{click:function(e){t.textImportModal.show=!1}}},[t._v("取消")])],1)])],1)}),[],!1,null,"67f1d304",null);e.default=component.exports},753:function(t,e,n){"use strict";n.r(e);n(67),n(97),n(60),n(46),n(76),n(72),n(132),n(50),n(89),n(48),n(145),n(186),n(160),n(146);var o=n(31),r=n(228),l=n(69),c=n(1102),d=n(724);function h(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,a){if(t){if("string"==typeof t)return v(t,a);var e={}.toString.call(t).slice(8,-1);return"Object"===e&&t.constructor&&(e=t.constructor.name),"Map"===e||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?v(t,a):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var o=0,r=function(){};return{s:r,n:function(){return o>=t.length?{done:!0}:{done:!1,value:t[o++]}},e:function(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var l,a=!0,u=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){u=!0,l=t},f:function(){try{a||null==n.return||n.return()}finally{if(u)throw l}}}}function v(t,a){(null==a||a>t.length)&&(a=t.length);for(var e=0,n=Array(a);e<a;e++)n[e]=t[e];return n}var f={components:{surveyView:c.default,questionSelect:d.default},data:function(){return{vueExp:"",options:{createSurvey:!1,enterNewSurvey:!1,data:{}},description:"",aiTopicModal:{show:!1,json:"",data:{questionTypes:[],direction:[]},list:[]},showView:!1,loading:!1,questionTypes:[{value:"radio",label:"单选题"},{value:"checkbox",label:"多选题"},{value:"text",label:"填空题"},{value:"matrix",label:"量表题"}],closed:!1,structures:[],newStructures:[{value:"",key:"new_structure_0"}],checkAll:!1,generateSurveyLoading:!1,generatedSurvey:!1,generatedStructures:!1,generateStructuresTimes:0,generateStructuresLoading:!1,generateQuestionLoading:!1,createModal:{show:!1,data:{}},projectList:[],projectLoad:{page:{index:0,size:10},loading:!1,noMore:!1},messageQueue:[],queueTimer:!1,renderThrottled:!1,queueInterval:30,surveyData:{title:"",description:"",questions:[]},surveyResult:{index:0,titleText:"",questionText:"",lastJson:"",lastTimer:null}}},computed:{allStructures:function(){return this.newStructures.filter((function(t){return!!t.value})).map((function(t){return t.key})).concat(this.structures||[])},isIndeterminate:function(){return this.allStructures.length>0&&this.aiTopicModal.data.direction.length>0&&this.aiTopicModal.data.direction.length!=this.allStructures.length},openGoodsAuth:function(){return this.vueExp.$store.state.openGoodsAuth||{}}},mounted:function(){this.openGoodsAuth.surveyDataSet&&this.openGoodsAuth.aiDataAnalyzer.includes("questionnaireGeneration")?!this.options.createSurvey||!this.openGoodsAuth.surveyDataSetNum||this.openGoodsAuth.surveyDataSetNum<=0?this.aiTopic():this.checkDataSetNum():this.vueExp.showNoAuthMessage()},methods:{checkDataSetNum:function(){var t=this,e=o.Loading.service({fullscreen:!0});this.$axios({method:"get",url:"project/dataSet/findUserHasDataSetCount/ORIGINALCASE/ONLINE"}).then((function(n){if(e.close(),n.resultStatus){var o=n.result||0;t.openGoodsAuth.surveyDataSetNum<=o?t.vueExp.showNoAuthMessage({status:5e4}):t.aiTopic()}else t.$message.error(n.message)})).catch((function(t){e.close(),console.error(t)}))},checkNum:function(t,e,n){if(!e)return n();return/^([1-9]\d*)$/.test(e)?e>20?n(new Error("题目数量最多不超过20")):n():n(new Error("请输入正确的格式"))},checkProject:function(t,e,n){return"new"==this.createModal.data.projectType||this.createModal.data.projectId?n():n(new Error("请选择已有项目"))},setDefaultTheme:function(t){for(var i in r)if("default"==r[i].key){for(var e in r[i].json)t[e]=r[i].json[e];break}return t.themeName="default",t},handleCheckAllChange:function(t){this.$set(this.aiTopicModal.data,"direction",t?this.allStructures:[]),this.handleCheckedStructuresChange()},handleCheckedStructuresChange:function(t){var e=this.aiTopicModal.data.direction.length;this.checkAll=0!=e&&e===this.allStructures.length},aiTopic:function(){var data=this.options.data||{};this.aiTopicModal={show:!0,json:"",data:{title:data.title||"",subjects:data.subjects||"",purpose:data.purpose||"",questionTypes:[],direction:[]},list:[]}},cancelGenerateStructures:function(){var t=this;this.$confirm("是否确认取消设置生成调研方向？",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){t.generatedStructures=!1,t.structures=[],t.aiTopicModal.data.direction=[]})).catch((function(){t.$message.info("已取消")}))},generateStructures:function(){var t=this;this.aiTopicModal.data.title?this.generateStructuresTimes>=3?this.$message.error("调研方向生成次数已用尽"):this.$refs.form.validate((function(e){if(!e)return console.log("error submit!!"),!1;t.submitGenerateStructures()})):this.$message.error("问卷主题为空")},clearGeneratedStructures:function(){if(this.aiTopicModal.data.direction&&this.aiTopicModal.data.direction.length>0)for(var t=this.aiTopicModal.data.direction,i=0;i<this.structures.length;i++)t.includes(this.structures[i])&&t.splice(t.indexOf(this.structures[i]),1);this.structures=[],this.handleCheckedStructuresChange()},submitGenerateStructures:function(){var t=this;this.generateStructuresLoading=!0,this.generatedStructures=!0,this.clearGeneratedStructures();var e=0,text="";this.$axios({method:"post",url:"project/ai/stream/generate/researchDirection",data:{title:this.aiTopicModal.data.title,subjects:this.aiTopicModal.data.subjects,purpose:this.aiTopicModal.data.purpose},headers:{Accept:"text/event-stream"},onDownloadProgress:function(n){var o=n.target.responseText;try{var r=o.split("\n\n").filter((function(t){return""!==t.trim()}));if(r.length>e){var c=r.slice(e);e=r.length;var d,v=h(c);try{for(v.s();!(d=v.n()).done;){var f=d.value;if(f&&f.startsWith("data: "))try{var m=f.substring(6);if(!m)continue;if("[DONE]"===m){t.generateStructuresLoading=!1;continue}var y=JSON.parse(m),x=y.event_data;if("error"==y.event_type)return t.$message.error(x.message),t.generateStructuresLoading=!1,void(t.generatedStructures=!1);if("survey_direction"!=y.event_type)continue;if(null==x)continue;if(text+=x){var _=Object(l.parseJSON)(text);console.info(_),t.structures=JSON.parse(JSON.stringify(_.structures||[])),$(".structures-list .el-scrollbar__wrap").scrollTop($(".structures-list .el-scrollbar__wrap")[0].scrollHeight-100)}}catch(t){console.error("解析SSE数据失败:",t,f)}}}catch(t){v.e(t)}finally{v.f()}}}catch(t){console.error(n.target,o)}}}).then((function(e){t.generateStructuresLoading=!1,t.generateStructuresTimes<3&&(t.generateStructuresTimes+=1)})).catch((function(e){t.generateStructuresLoading=!1,t.$message.error("生成失败")}))},addNewStructure:function(){for(var t="new_structure_",label="",e=this.newStructures.map((function(t){return t.key})),i=0;i<=3;i++)if(!e.includes(t+i)){label=t+i;break}this.newStructures.push({value:"",key:label}),this.handleCheckedStructuresChange()},delNewStructure:function(t,e){this.newStructures.length<=1||(this.aiTopicModal.data.direction.includes(t.key)&&this.aiTopicModal.data.direction.splice(this.aiTopicModal.data.direction.indexOf(t.key),1),this.newStructures.splice(e,1),this.handleCheckedStructuresChange())},changeStructure:function(t){var e=this,n=this.newStructures[t],o=n.key,text=n.value;if(!text)return this.aiTopicModal.data.direction.includes(o)&&this.aiTopicModal.data.direction.splice(this.aiTopicModal.data.direction.indexOf(o),1),void this.handleCheckedStructuresChange();this.newStructures.filter((function(e,n){return t!=n})).map((function(t){return t.value})).concat(this.structures).includes(text)?(this.$message.error("存在重复数据"),this.newStructures[t].value="",this.$nextTick((function(){if(e.$refs[o]){var t=e.$refs[o];Array.isArray(t)&&(t=t[0]),t&&t.focus&&t.focus()}})),this.aiTopicModal.data.direction.includes(o)&&this.aiTopicModal.data.direction.splice(this.aiTopicModal.data.direction.indexOf(o),1)):this.aiTopicModal.data.direction.includes(o)||this.aiTopicModal.data.direction.push(o),this.handleCheckedStructuresChange()},confirmAiTopic:function(){var t=this;this.aiTopicModal.data.title?this.$refs.form.validate((function(e){if(!e)return console.log("error submit!!"),!1;t.$confirm("是否确认生成该主题问卷？",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){t.submitAiTopic()})).catch((function(){t.$message.info("已取消")}))})):this.$message.error("问卷主题为空")},enqueueMessage:function(t){this.messageQueue.push(t),this.startQueue()},startQueue:function(){var t=this;this.queueTimer||(this.queueTimer=setInterval((function(){t.processQueue(),0===t.messageQueue.length&&(clearInterval(t.queueTimer),t.queueTimer=!1)}),this.queueInterval))},processQueue:function(){if(0!==this.messageQueue.length){var t=this.messageQueue.shift();this.handleQueueMessageSync(t)}},stopQueue:function(){this.queueTimer&&(clearInterval(this.queueTimer),this.queueTimer=!1),this.messageQueue=[],this.surveyResult.lastTimer&&(clearTimeout(this.surveyResult.lastTimer),this.surveyResult.lastTimer=null)},handleQueueMessageSync:function(t){var e=this;try{var n=t.substring(6);if(!n)return;if("[DONE]"===n)return this.generatedSurvey=!0,this.generateSurveyLoading=!1,this.loading=!1,this.surveyData.done=!0,this.renderSurvey(this.surveyData),void this.$refs.questionSelect.handleCheckAllChange(!0);var o=JSON.parse(n),r=o.event_data;if("error"==o.event_type)return console.info(r),this.$message.error(r.message),this.generateSurveyLoading=!1,this.loading=!1,void(this.generatedSurvey=!0);if("survey"!=o.event_type)return;if(null==r)return;if(this.generateSurveyLoading=!1,"title"===r.type){this.surveyResult.titleText+=r.data;try{var c=Object(l.parseJSON)(this.surveyResult.titleText);this.surveyData.title=c.title||"",this.surveyData.description=c.description||""}catch(t){}}else if("question"===r.type){r.index!=this.surveyResult.index&&(this.surveyResult.questionText=""),this.surveyResult.index=r.index,this.surveyResult.questionText+=r.data;try{var d=Object(l.parseJSON)(this.surveyResult.questionText);d=d.question||d||{},this.surveyData.questions[this.surveyResult.index]=d}catch(t){}}this.surveyData.done=!1,this.renderThrottled||(this.renderThrottled=!0,setTimeout((function(){e.renderSurvey(e.surveyData),e.renderThrottled=!1}),100))}catch(e){console.error("解析SSE数据失败:",e,t)}},submitAiTopic:function(){var t=this;this.aiTopicModal.list=[],this.showView&&this.$refs.questionSelect&&this.$refs.questionSelect.handleCheckAllChange&&this.$refs.questionSelect.handleCheckAllChange(!1),this.loading=!0,this.generateSurveyLoading=!0,this.generatedSurvey=!1,this.generateStructuresTimes=0;var data=JSON.parse(JSON.stringify(this.aiTopicModal.data));if(data.questionNum||(data.questionNum=10),data.direction&&data.direction.length)for(var i=0;i<this.newStructures.length;i++)data.direction.includes(this.newStructures[i].key)&&data.direction.splice(data.direction.indexOf(this.newStructures[i].key),1,this.newStructures[i].value);this.surveyResult={index:0,titleText:"",questionText:""};var e=0;this.surveyData.title="",this.surveyData.description="",this.surveyData.questions=[],this.$axios({method:"post",url:"project/ai/stream/generate/surveyV2",data:data,headers:{Accept:"text/event-stream"},onDownloadProgress:function(n){var o=n.target.responseText.split("\n\n").filter((function(t){return""!==t.trim()}));if(o.length>e){var r=o.slice(e);e=o.length;var l,c=h(r);try{for(c.s();!(l=c.n()).done;){var d=l.value;d&&d.startsWith("data: ")&&t.enqueueMessage(d)}}catch(t){c.e(t)}finally{c.f()}}}}).then((function(t){})).catch((function(e){t.generatedSurvey=!0,t.generateSurveyLoading=!1,t.generateQuestionLoading=!1,t.loading=!1,t.$message.error("生成失败")}))},renderSurvey:function(t){var e=JSON.stringify(t);this.surveyResult.lastJson!=e&&(this.showView||(this.showView=!0),this.aiTopicModal.json=this.handleJSON(t),this.surveyResult.lastJson=e,this.$nextTick((function(){$(".question-list-box .el-scrollbar__wrap").scrollTop($(".question-list-box .el-scrollbar__wrap")[0].scrollHeight)})))},handleJSON:function(t){var e=JSON.parse(JSON.stringify(t)),n=this.questionTypes.map((function(t){return t.value})),o=[];if(e.questions&&Array.isArray(e.questions)&&e.questions.length>0)for(var r=0;r<e.questions.length;r++){var l=e.questions[r];if(l){l.type&&(l.type=l.type.toLowerCase()),"multipletext"===l.type&&(l.type="text");var c={title:l.title||"<span></span>",valueName:l.valueName||"P1Q"+(r+1),name:l.valueName||"P1Q"+(r+1),isRequired:!0,type:l.type?!n.includes(l.type)&&l.options||"radio"==l.type?"radiogroup":l.type:"text"};if(["radiogroup","checkbox"].includes(c.type)){if(l.options&&(l.choices=l.options),Array.isArray(l.choices)){c.choices=[];for(var d=0;d<l.choices.length;d++){var text=l.choices[d]||"<span></span>",h={value:(d+1).toString(),text:text};text.includes("其他")&&(h.hasInput=!0),c.choices.push(h)}}}else if("matrix"==l.type){if(Array.isArray(l.rows)&&l.rows.length>0){c.rows=[];for(d=0;d<l.rows.length;d++){text=l.rows[d]||"<span></span>",h={value:(d+1).toString(),text:text};c.rows.push(h)}}else c.rows=[{value:"1",text:"加载中..."}];if(Array.isArray(l.columns)&&l.columns.length>0){c.columns=[];for(d=0;d<l.columns.length;d++){text=l.columns[d]||"<span></span>";(h={value:(d+1).toString(),text:text}).value==h.text&&(h=h.value),c.columns.push(h)}}else c.columns=[{value:"1",text:"加载中..."}]}o.push(c)}}this.description=e.description||"";var v={title:e.title||"<span></span>",description:'<div style="text-indent: 2em;font-size: 16px;">'.concat(this.description,"</div>"),pages:[{name:"Page1",elements:o}]};return v.done=e.done||!1,JSON.parse(JSON.stringify(this.setDefaultTheme(v)))},confirmSurvey:function(){var t=this;0!=this.aiTopicModal.list.length?this.aiTopicModal.data.subjects?this.aiTopicModal.data.subjects?this.options.createSurvey?(this.createModal={show:!0,data:{surveyName:this.aiTopicModal.json.title||this.aiTopicModal.data.title||"",projectType:"new"}},this.$nextTick((function(){t.$refs.create.clearValidate()}))):this.completeSurvey():this.$message.error("请输入调研目的"):this.$message.error("请输入调研对象"):this.$message.error("请选择问卷题目")},confirmCreateSurvey:function(){var t=this;this.$refs.create.validate((function(e){if(!e)return console.log("error submit!!"),!1;t.$confirm("是否确认创建问卷",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){t.submitCreateSurvey()})).catch((function(){t.$message.info("已取消")}))}))},submitCreateSurvey:function(){var t=this,data={surveyName:this.createModal.data.surveyName,survey:this.getSelectedSurvey(),targetSummary:this.aiTopicModal.data.subjects,dataSetSummary:this.aiTopicModal.data.purpose};"new"==this.createModal.data.projectType?data.projectName=this.createModal.data.projectName||data.surveyName:(data.projectId=this.createModal.data.projectId,data.projectName=(this.projectList[this.projectList.map((function(t){return t.id})).indexOf(data.projectId)]||{}).projectName||""),this.$axios({method:"post",url:"project/dataSet/createAISurvey",data:data}).then((function(e){if(e.resultStatus){if(t.options.enterNewSurvey){var data=e.result||{},n=t.vueExp&&t.vueExp.$router||$nuxt&&$nuxt.$router,o="/project/charge/".concat(data.projectId,"/dataSet/").concat(data.id,"/survey/editor?id=").concat(data.questionnaireId,"&type=surveyEdit");n&&n.push?n.push(o):window.location.href=o}t.completeSurvey()}else t.$message.error(e.message)}))},getProject:function(t){var e=this;t&&(this.projectList=[],this.projectLoad.page.index=0,this.projectLoad.noMore=!1,this.projectLoad.loading=!1),this.projectLoad.noMore||this.projectLoad.loading||(this.projectLoad.loading=!0,this.projectLoad.page.index++,this.$axios({method:"post",url:"project/project/findAdminProjects",data:{pageFilter:{pageIndex:this.projectLoad.page.index-1,pageSize:this.projectLoad.page.size}}}).then((function(t){e.projectLoad.loading=!1,t.resultStatus?((!t.result.content||t.result.content.length<e.projectLoad.page.size)&&(e.projectLoad.noMore=!0),e.projectList=e.projectList.concat(t.result.content)):(e.projectLoad.noMore=!0,e.$message.error(t.message))})).catch((function(t){console.log(t),e.projectLoad.loading=!1,e.projectLoad.noMore=!0})))},getSelectedSurvey:function(){return JSON.parse(JSON.stringify(this.setDefaultTheme({title:this.aiTopicModal.json.title,pages:[{name:"Page1",elements:[{type:"html",name:"html_1_1",valueName:"html_1_1",html:'<div style="text-indent: 2em;font-size: 16px;">'.concat(this.description,"</div>")}].concat(this.aiTopicModal.list.map((function(t){return"startWithNewLine"in t&&delete t.startWithNewLine,t})))}]})))},completeSurvey:function(){this.closed=!0,this.aiTopicModal.show=!1,this.resolve(JSON.stringify(this.getSelectedSurvey())),this.$message.success("生成成功")},close:function(){!this.closed&&this.reject&&this.reject()},beforeClose:function(t){var e=this;this.closed?t():this.$confirm("弹窗关闭后，数据不会被保留</br>是否确认要关闭弹窗？",{confirmButtonText:"确定",cancelButtonText:"取消",dangerouslyUseHTMLString:!0,type:"warning"}).then((function(){t()})).catch((function(){e.$message.info("已取消")}))}},beforeUnmount:function(){this.stopQueue()}},m=f,y=(n(1440),n(1442),n(10)),component=Object(y.a)(m,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"extend-act-box"},[e("el-dialog",{attrs:{"append-to-body":"",visible:t.aiTopicModal.show,width:"1400px","custom-class":"ai-survey-modal","before-close":t.beforeClose,top:"5vh"},on:{"update:visible":function(e){return t.$set(t.aiTopicModal,"show",e)},closed:function(e){return t.close()}}},[e("div",{staticClass:"ai-survey-box"},[e("div",{staticClass:"ai-survey-form"},[e("div",{staticClass:"ai-form-title"},[e("img",{attrs:{src:"/images/icon/Frame%20113@2x.png",alt:""}}),t._v(" "),e("span",[t._v("AI生成问卷")])]),t._v(" "),e("el-form",{ref:"form",staticClass:"ai-form-content",staticStyle:{"margin-right":"-24px"},attrs:{size:"small",model:t.aiTopicModal.data,"label-suffix":"：","label-position":"top"}},[e("el-scrollbar",{staticClass:"scrollbar_y",staticStyle:{height:"100%"}},[e("div",{staticStyle:{"padding-right":"24px"}},[e("el-form-item",{attrs:{label:"调研主题",prop:"title",rules:[{required:!0,message:"请输入调研主题"}]}},[e("el-input",{attrs:{placeholder:"请输入调研主题",maxlength:"30","show-word-limit":"",clearable:""},model:{value:t.aiTopicModal.data.title,callback:function(e){t.$set(t.aiTopicModal.data,"title",e)},expression:"aiTopicModal.data.title"}})],1),t._v(" "),e("el-form-item",{attrs:{label:"调研对象",prop:"subjects",rules:[{required:!0,message:"请输入调研对象"}]}},[e("el-input",{attrs:{placeholder:"请输入调研对象",maxlength:"30","show-word-limit":"",clearable:""},model:{value:t.aiTopicModal.data.subjects,callback:function(e){t.$set(t.aiTopicModal.data,"subjects",e)},expression:"aiTopicModal.data.subjects"}})],1),t._v(" "),e("el-form-item",{attrs:{label:"调研目的",prop:"purpose",rules:[{required:!0,message:"请输入调研目的"}]}},[e("el-input",{attrs:{type:"textarea",placeholder:"请输入调研目的",maxlength:"200","show-word-limit":"",clearable:""},model:{value:t.aiTopicModal.data.purpose,callback:function(e){t.$set(t.aiTopicModal.data,"purpose",e)},expression:"aiTopicModal.data.purpose"}})],1),t._v(" "),e("el-form-item",{attrs:{label:"",prop:"direction"}},[e("template",{slot:"label"},[e("span",[t._v("调研方向：")]),t._v(" "),e("el-tooltip",{attrs:{placement:"right",content:"说明：ai会根据调研主题、对象、目的，生成不同调研维度以供选择，以便生成的问卷题目更有针对性"}},[e("span",{staticClass:"tips-icon"},[e("i",{staticClass:"iconfont icon-boolean"})])]),t._v(" "),t.generatedStructures?[e("el-button",{staticClass:"link-btn",staticStyle:{color:"#666"},attrs:{loading:t.generateStructuresLoading,type:"text"},on:{click:function(e){return t.cancelGenerateStructures()}}},[t._v("取消设置生成调研方向")]),t._v(" "),e("el-button",{staticClass:"link-btn",staticStyle:{float:"right"},attrs:{loading:t.generateStructuresLoading,disabled:t.generateStructuresTimes>=3,type:"text"},on:{click:function(e){return t.generateStructures()}}},[t._v("重新生成("+t._s(t.generateStructuresTimes)+"/3)")])]:e("el-button",{staticClass:"link-btn",attrs:{disabled:t.generateStructuresTimes>=3,loading:t.generateStructuresLoading,type:"text"},on:{click:function(e){return t.generateStructures()}}},[t._v("AI生成调研方向")])],2),t._v(" "),t.generatedStructures?e("div",{staticClass:"structures-content"},[e("el-checkbox",{attrs:{indeterminate:t.isIndeterminate},on:{change:t.handleCheckAllChange},model:{value:t.checkAll,callback:function(e){t.checkAll=e},expression:"checkAll"}},[t._v("全选")]),t._v(" "),e("div",{staticClass:"structures-list"},[e("el-scrollbar",{staticClass:"scrollbar_y",staticStyle:{height:"100%"}},[e("el-checkbox-group",{on:{change:t.handleCheckedStructuresChange},model:{value:t.aiTopicModal.data.direction,callback:function(e){t.$set(t.aiTopicModal.data,"direction",e)},expression:"aiTopicModal.data.direction"}},[t._l(t.structures,(function(i){return e("el-checkbox",{key:i,staticClass:"structures-item",attrs:{label:i}},[e("span",[t._v(t._s(i))])])})),t._v(" "),t._l(t.newStructures,(function(i,n){return e("div",{staticClass:"structures-item-box"},[e("el-checkbox",{key:i.key,staticClass:"structures-item",attrs:{disabled:!i.value,label:i.key}},[e("el-input",{ref:i.key,refInFor:!0,staticStyle:{width:"200px"},attrs:{size:"mini",maxlength:"10","show-word-limit":"",clearable:""},on:{change:function(e){return t.changeStructure(n)}},model:{value:i.value,callback:function(e){t.$set(i,"value",e)},expression:"i.value"}})],1),t._v(" "),e("div",{staticClass:"structures-item-act"},[t.newStructures.length<3?e("el-button",{staticClass:"structures-btn",staticStyle:{color:"#62d346"},attrs:{title:"添加",type:"text"},on:{click:function(e){return t.addNewStructure()}}},[e("i",{staticClass:"el-icon-circle-plus-outline"})]):t._e(),t._v(" "),t.newStructures.length>1?e("el-button",{staticClass:"structures-btn",staticStyle:{color:"#ff0000"},attrs:{title:"删除",type:"text"},on:{click:function(e){return t.delNewStructure(i,n)}}},[e("i",{staticClass:"el-icon-circle-close"})]):t._e()],1)],1)}))],2)],1)],1)],1):t._e()],2),t._v(" "),e("el-form-item",{attrs:{label:"预计题目数量",prop:"questionNum",rules:[{validator:t.checkNum}]}},[e("template",{slot:"label"},[e("span",[t._v("预计题目数量：")]),t._v(" "),e("span",{staticStyle:{color:"#999"}},[t._v("（最多不超过20道题）")])]),t._v(" "),e("el-input",{attrs:{clearable:"",placeholder:"10"},model:{value:t.aiTopicModal.data.questionNum,callback:function(e){t.$set(t.aiTopicModal.data,"questionNum",e)},expression:"aiTopicModal.data.questionNum"}})],2),t._v(" "),e("el-form-item",{attrs:{label:"题型",prop:"questionTypes"}},[e("template",{slot:"label"},[e("span",[t._v("题型：")]),t._v(" "),e("el-tooltip",{attrs:{placement:"right",content:"说明：生成的题目题型包含选中题型"}},[e("span",{staticClass:"tips-icon"},[e("i",{staticClass:"iconfont icon-boolean"})])])],1),t._v(" "),e("el-checkbox-group",{model:{value:t.aiTopicModal.data.questionTypes,callback:function(e){t.$set(t.aiTopicModal.data,"questionTypes",e)},expression:"aiTopicModal.data.questionTypes"}},t._l(t.questionTypes,(function(i){return e("el-checkbox",{key:i.value,staticStyle:{"margin-right":"20px"},attrs:{label:i.value}},[t._v(t._s(i.label))])})),1)],2)],1)])],1),t._v(" "),e("div",{staticClass:"ai-form-act"},[e("el-button",{staticClass:"ai-submit-btn",attrs:{type:"primary",loading:t.loading},on:{click:function(e){return t.confirmAiTopic()}}},[t._v(t._s(t.loading?"生成中":t.aiTopicModal.json&&t.aiTopicModal.json.pages?"重新生成":"开始生成"))])],1)],1),t._v(" "),e("div",{staticClass:"ai-survey-view"},[e("div",{staticClass:"ai-view-title"},[t._v("题目预览")]),t._v(" "),e("div",{staticClass:"ai-view-content"},[t.generateSurveyLoading?e("div",{staticClass:"ai-loading-box"},[e("div",{staticClass:"ai-loading"},[e("img",{attrs:{src:"/images/icon/Loading Carga.gif",alt:""}}),t._v(" "),e("p",[t._v("AI 响应需要一定时间，请耐心等待.....")])])]):t._e(),t._v(" "),t.showView&&t.aiTopicModal.json&&t.aiTopicModal.json.pages?e("question-select",{ref:"questionSelect",attrs:{disabled:!t.generatedSurvey,json:t.aiTopicModal.json},model:{value:t.aiTopicModal.list,callback:function(e){t.$set(t.aiTopicModal,"list",e)},expression:"aiTopicModal.list"}}):e("el-empty",{staticClass:"empty-box",attrs:{image:"/images/icon/emptystate@2x.png",description:"暂无问卷内容，请先在左侧输入你的问卷预期吧"}})],1),t._v(" "),e("div",{staticClass:"ai-view-act"},[e("div",{staticClass:"ai-view-tips"},[t._v("以上生成的所有内容均由人工智能模型生成，其生成内容的准确性和完整性无法保证，不代表我们的态度或观点")]),t._v(" "),e("transition",{attrs:{name:"el-fade-in-linear"}},[e("div",{directives:[{name:"show",rawName:"v-show",value:t.generateQuestionLoading,expression:"generateQuestionLoading"}],staticClass:"question-box-next-loading"},[e("img",{attrs:{src:"/images/icon/Loading Carga.gif",alt:""}})])]),t._v(" "),e("el-button",{attrs:{disabled:0==t.aiTopicModal.list.length,type:"primary"},on:{click:function(e){return t.confirmSurvey()}}},[t._v("创建问卷")])],1)])])]),t._v(" "),e("el-dialog",{attrs:{"append-to-body":"",title:"创建数据集问卷",visible:t.createModal.show,width:"500px","custom-class":"small-padding-modal"},on:{"update:visible":function(e){return t.$set(t.createModal,"show",e)}}},[e("div",{staticClass:"modal-box"},[e("el-form",{ref:"create",attrs:{size:"small","label-suffix":"：","label-position":"top",model:t.createModal.data}},[e("el-form-item",{attrs:{label:"问卷名称",prop:"surveyName",rules:[{required:!0,message:"请输入问卷名称"}]}},[e("el-input",{model:{value:t.createModal.data.surveyName,callback:function(e){t.$set(t.createModal.data,"surveyName",e)},expression:"createModal.data.surveyName"}})],1),t._v(" "),e("el-form-item",{attrs:{label:"所在项目",prop:"project",rules:[{validator:t.checkProject}]}},[e("el-radio-group",{model:{value:t.createModal.data.projectType,callback:function(e){t.$set(t.createModal.data,"projectType",e)},expression:"createModal.data.projectType"}},[e("el-radio",{attrs:{label:"new"}},[e("span",[t._v("创建新的项目")]),t._v(" "),e("el-input",{staticStyle:{width:"345px"},attrs:{placeholder:t.createModal.data.surveyName||""},on:{click:function(t){t.stopPropagation()},change:function(e){t.createModal.data.projectType="new"}},model:{value:t.createModal.data.projectName,callback:function(e){t.$set(t.createModal.data,"projectName",e)},expression:"createModal.data.projectName"}})],1),t._v(" "),e("el-radio",{staticStyle:{"margin-top":"10px"},attrs:{label:"exist"}},[e("span",[t._v("选择已有项目")]),t._v(" "),e("select-infinite",{staticStyle:{width:"345px"},attrs:{placeholder:"请选择已有项目"},on:{load:function(e){return t.getProject(!0)},loadMore:function(e){return t.getProject(!1)},click:function(t){t.stopPropagation()},change:function(e){t.createModal.data.projectType="exist"}},model:{value:t.createModal.data.projectId,callback:function(e){t.$set(t.createModal.data,"projectId",e)},expression:"createModal.data.projectId"}},t._l(t.projectList,(function(t){return e("el-option",{key:t.id,attrs:{label:t.projectName,value:t.id}})})),1)],1)],1)],1)],1)],1),t._v(" "),e("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(e){return t.confirmCreateSurvey()}}},[t._v("创建")]),t._v(" "),e("el-button",{attrs:{size:"small"},on:{click:function(e){t.createModal.show=!1}}},[t._v("取消")])],1)])],1)}),[],!1,null,"1ccadeb3",null);e.default=component.exports},754:function(t,e,n){"use strict";n.r(e);var o={components:{surveyTemplate:n(1015).default},data:function(){return{options:{},showChooseTemplate:!1,closed:!1}},mounted:function(){this.chooseTemplate()},methods:{chooseTemplate:function(){this.showChooseTemplate=!0},confirmTemplate:function(t){var e=this;this.$confirm("是否确认选择该模板",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){e.showChooseTemplate=!1,e.closed=!0,e.resolve(JSON.stringify(t))})).catch((function(){e.$message.info("已取消")}))},close:function(){!this.closed&&this.reject&&this.reject()}}},r=(n(1446),n(10)),component=Object(r.a)(o,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"extend-act-box"},[e("el-dialog",{attrs:{"append-to-body":"",title:"选择问卷模板",visible:t.showChooseTemplate,top:"5vh",width:"1280px","custom-class":"small-padding-modal"},on:{"update:visible":function(e){t.showChooseTemplate=e},closed:function(e){return t.close()}}},[e("div",{staticClass:"template-modal-box",staticStyle:{height:"calc(90vh - 140px)"}},[e("surveyTemplate",{attrs:{type:"choose"},on:{select:t.confirmTemplate}})],1),t._v(" "),e("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{attrs:{size:"small"},on:{click:function(e){t.showChooseTemplate=!1}}},[t._v("关闭")])],1)])],1)}),[],!1,null,"e344d546",null);e.default=component.exports},755:function(t,e,n){"use strict";n.r(e);n(46),n(48);var o={data:function(){return{model:{},showFun:!1,questionClearInvisibleHelp:'<div>当问卷中设置了逻辑显隐题时，隐藏题目的展示及数据留存的配置。</div><div style="display:flex;"><div>继承：</div><div><div>初始默认为继承，即与【问卷设置-数据-清除隐藏值】页面参数保持一致；</div><div>可切换，即当前题目的逻辑配置关于隐藏值的设置均被修改</div></div></div><div>不清除：提交时，保留隐藏题目的数据</div><div>完成时：在提交时清除关联关系</div><div>例如，Q1Q2Q3三道选择题，逻辑设置，选择Q1的选项一，显示Q2，选择Q2的选项一，显示Q3；</div><div>答题者首次选择Q1选项一，Q2选项一，此时三道题全部显示；</div><div style="display:flex;"><div>此时切换Q1为选项二，</div><div><div>若默认继承，则跟随父级(问卷设置中)保持一致；</div><div>若选择不清除，则当前会显示Q1、Q3题，且提交数据时保留Q2题目的数据；</div><div>若选择完成时，则当前会显示Q1、Q3题，且提交数据清除Q2题目的数据。</div></div></div>',funList:[{name:"iif",params:"[ expr, truepart, falsepart ]",des:"expr 为用来判断真伪的表达式：</br>如果 expr 为 true，则返回 truepart 的值或表达式；</br>反之，如果 expr 为 false，则返回 falsepart 的值或表达式。",example:"iif({P1Q1}=1, 1, 0)"},{name:"count",des:"获取参数总数，如多选题选中数量（可传多个参数）",example:"count({P1Q1}, {P1Q2})"},{name:"min",des:"获取参数中最小值",example:"min({P1Q1}, {P1Q2})"},{name:"max",des:"获取参数中最大值",example:"max({P1Q1}, {P1Q2})"},{name:"avg",des:"获取所有参数的平均值",example:"avg({P1Q1}, {P1Q2})"},{name:"sum",des:"获取所有参数的总数",example:"sum({P1Q1}, {P1Q2})"},{name:"serverTime",des:"获取服务器时间",example:"serverTime()"},{name:"getYear",des:"根据传入的时间参数，获取年份",example:"getYear(serverTime()) 或 getYear('2000') 或 getYear('2000-01-01') 或 getYear('2000-01-01 00:00:00')"},{name:"getMonth",des:"根据传入的时间参数，获取月份",example:"getMonth(serverTime()) 或 getMonth('2000-01-01') 或 getMonth('2000-01-01 00:00:00')"},{name:"getDate",des:"根据传入的时间参数，获取日期",example:"getDate(serverTime()) 或 getDate('2000-01-01') 或 getDate('2000-01-01 00:00:00')"},{name:"age",des:"根据传入的时间参数，获取年龄",example:"age('2000') 或 age('2000-01-01') 或 age('2000-01-01 00:00:00')"},{name:"diffDays",params:"[ time1, time2 ]",des:"根据传入的时间参数，获取相差天数（限传两个参数）",example:"diffDays('2000-01-01', '2000-12-01') 或 diffDays('2000-01-01 00:00:00', '2000-12-01 00:00:00')"},{name:"regexValidate",params:"[ value, regex ]",des:"判断传入值是否符合正则表达式</br>value: 值, regex: 正则表达式",example:"regexValidate({P1Q1}, '^d$')"},{name:"limitCount",params:"[ valueName, value, limitValue, count ]",des:"限制选项填答次数</br>valueName: 题目, value: 当前题目值, limitValue: 限制的值, count: 限制的个数。",example:"limitCount('P1Q1', {P1Q1}, '男', 500)</br>选择 男 的个案超过500个后，返回 false ；否则，返回 true 。"},{name:"limitPhone",params:"[ valueName, value, count ]",des:"限制手机号填答次数</br>valueName: 存储手机号题目, value: 当前题目(手机号), count: 限制个数。",example:"limitPhone('phone', {phone}, 1)</br>当前手机号的个案超过1个后，返回 false ；否则，返回 true 。"},{name:"checkAnsweredByDataSetId",params:"[ dataSetId, variableNames, values ]",des:"限制账号填答次数</br>dataSetId: 判断填答数量的数据集id, variableNames: 题目, values: 题目值（题目及题目值可多选，需有对应关系）",example:"checkAnsweredByDataSetId(dataSetId, 'P1Q1', {P1Q1}) 或 checkAnsweredByDataSetId(dataSetId, ['P1Q1', 'P1Q2'], [{P1Q1}, {P1Q2}])"},{name:"saveRanking",params:"[ targetVarName, fieldValues ]",des:"保存排名</br>targetVarName为排名后台存储变量，必填，须创建一个空填空题或者表达式题，然后传该题的变量名，后台数据管理会根据标题名存储变量描述</br>fieldValues为筛选变量，为空显示总排名，可传数组['P1Q1', {P1Q1}]，第一个为变量名，第二个为值表达式",example:"saveRanking('P1Q1') 或 saveRanking('P1Q1', ['P1Q2', {P1Q2}], ['P1Q3', {P1Q3}])"},{name:"encrypt",params:"[ value, key ]",des:"加密</br>value为需要加密的数据，必填，</br>key为加密秘钥，为空时取问卷设置“url参数加密秘钥”的值",example:"encrypt({P1Q1}}) 或 encrypt({P1Q1}, 'a')"},{name:"decrypt",params:"[ value, key ]",des:"解密</br>value为需要解密的数据，必填，</br>key为加密秘钥，为空时取问卷设置“url参数加密秘钥”的值",example:"decrypt({P1Q1}}) 或 decrypt({P1Q1}, 'a')"}]}},computed:{questionType:function(){return this.model.object&&this.model.object.getType&&this.model.object.getType()||""},helpText:function(){return"clearInvisibleValues"==this.model.editablePropertyName&&this.questionType&&"survey"!=this.questionType?this.questionClearInvisibleHelp:this.model.propertyHelpText}},mounted:function(){},methods:{}},r=(n(1448),n(10)),component=Object(r.a)(o,(function(){var t=this,e=t._self._c;return e("span",[["expression","condition"].includes(t.model.editorType)?e("el-button",{attrs:{type:"text"},on:{click:function(e){t.showFun=!0}}},[t._v("内置函数")]):t._e(),t._v(" "),e("el-tooltip",{attrs:{placement:"top",effect:"light"}},[e("div",{attrs:{slot:"content"},domProps:{innerHTML:t._s(t.helpText)},slot:"content"}),t._v(" "),t.helpText?e("i",{staticClass:"help-text-icon el-icon-question"}):t._e()]),t._v(" "),e("el-dialog",{attrs:{"append-to-body":"",title:"内置函数",visible:t.showFun,top:"5vh",width:"900px","custom-class":"small-padding-modal"},on:{"update:visible":function(e){t.showFun=e}}},[e("div",{staticStyle:{height:"calc(90vh - 140px)"}},[e("el-scrollbar",{staticClass:"scrollbar_y",staticStyle:{height:"100%"}},t._l(t.funList,(function(i){return e("div",{staticClass:"function-item"},[e("div",{staticClass:"function-name",domProps:{innerHTML:t._s(i.name)}}),t._v(" "),i.params?e("div",{staticClass:"function-params"},[e("strong",[t._v("参数说明：")]),t._v(" "),e("span",{domProps:{innerHTML:t._s(i.params)}})]):t._e(),t._v(" "),i.des?e("div",{staticClass:"function-des",domProps:{innerHTML:t._s(i.des)}}):t._e(),t._v(" "),i.example?e("div",{staticClass:"function-example"},[e("strong",[t._v("案例：")]),t._v(" "),e("span",{domProps:{innerHTML:t._s(i.example)}})]):t._e()])})),0)],1),t._v(" "),e("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{attrs:{size:"small"},on:{click:function(e){t.showFun=!1}}},[t._v("关闭")])],1)])],1)}),[],!1,null,"3639da4c",null);e.default=component.exports},865:function(t,e,n){var content=n(1423);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[t.i,content,""]]),content.locals&&(t.exports=content.locals);(0,n(16).default)("447a813e",content,!0,{sourceMap:!1})},866:function(t,e,n){var content=n(1425);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[t.i,content,""]]),content.locals&&(t.exports=content.locals);(0,n(16).default)("7e1db2f0",content,!0,{sourceMap:!1})},870:function(t,e,n){var content=n(1433);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[t.i,content,""]]),content.locals&&(t.exports=content.locals);(0,n(16).default)("c7d396b4",content,!0,{sourceMap:!1})},872:function(t,e,n){var content=n(1437);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[t.i,content,""]]),content.locals&&(t.exports=content.locals);(0,n(16).default)("a0dcbe5e",content,!0,{sourceMap:!1})},873:function(t,e,n){var content=n(1439);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[t.i,content,""]]),content.locals&&(t.exports=content.locals);(0,n(16).default)("4f603ec5",content,!0,{sourceMap:!1})},874:function(t,e,n){var content=n(1441);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[t.i,content,""]]),content.locals&&(t.exports=content.locals);(0,n(16).default)("648dc4bc",content,!0,{sourceMap:!1})},875:function(t,e,n){var content=n(1443);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[t.i,content,""]]),content.locals&&(t.exports=content.locals);(0,n(16).default)("66424eae",content,!0,{sourceMap:!1})},878:function(t,e,n){var content=n(1447);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[t.i,content,""]]),content.locals&&(t.exports=content.locals);(0,n(16).default)("3bfad67c",content,!0,{sourceMap:!1})},879:function(t,e,n){var content=n(1449);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[t.i,content,""]]),content.locals&&(t.exports=content.locals);(0,n(16).default)("76aa14c8",content,!0,{sourceMap:!1})},906:function(t,e,n){var content=n(1511);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[t.i,content,""]]),content.locals&&(t.exports=content.locals);(0,n(16).default)("759584d7",content,!0,{sourceMap:!1})},921:function(t,e,n){var content=n(1541);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[t.i,content,""]]),content.locals&&(t.exports=content.locals);(0,n(16).default)("537f9cd0",content,!0,{sourceMap:!1})},922:function(t,e,n){var content=n(1543);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[t.i,content,""]]),content.locals&&(t.exports=content.locals);(0,n(16).default)("143a51c4",content,!0,{sourceMap:!1})}}]);