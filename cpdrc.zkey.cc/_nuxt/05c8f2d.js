(window.webpackJsonp=window.webpackJsonp||[]).push([[1197],{1661:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.Edit=void 0;var n=c(r(284)),l=c(r(1662)),o=c(r(83));function c(e){return e&&e.__esModule?e:{default:e}}var d={install:function(){o.default.reg("edit"),n.default.mixins.push(l.default)}};t.Edit=d;var f=d;t.default=f},1662:function(e,t,r){"use strict";function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var l=C(r(41)),o=C(r(83)),c=C(r(61)),d=m(r(64)),f=r(253),h=m(r(102)),v=r(108);function w(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(w=function(e){return e?r:t})(e)}function m(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==n(e)&&"function"!=typeof e)return{default:e};var r=w(t);if(r&&r.has(e))return r.get(e);var l={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var c in e)if("default"!==c&&Object.prototype.hasOwnProperty.call(e,c)){var desc=o?Object.getOwnPropertyDescriptor(e,c):null;desc&&(desc.get||desc.set)?Object.defineProperty(l,c,desc):l[c]=e[c]}return l.default=e,r&&r.set(e,l),l}function C(e){return e&&e.__esModule?e:{default:e}}function y(object,e){var t=Object.keys(object);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(object);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(object,e).enumerable}))),t.push.apply(t,r)}return t}function R(e){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?y(Object(source),!0).forEach((function(t){I(e,t,source[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(source)):y(Object(source)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(source,t))}))}return e}function x(e){return function(e){if(Array.isArray(e))return S(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return S(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return S(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function S(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,r=new Array(t);i<t;i++)r[i]=e[i];return r}function I(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function O(e,t,r){var n=e.tableFullTreeData,o=e.afterFullData,c=e.fullDataRowIdData,d=e.fullAllDataRowIdData,h=e.treeOpts,v=h.rowField,w=h.parentField,m=h.mapChildrenField,C=h.children||h.childrenField,y=r?"push":"unshift";t.forEach((function(t){var r=t[w],h=(0,f.getRowid)(e,t),R=r?l.default.findTree(n,(function(e){return r===e[v]}),{children:m}):null;if(R){var x=R.item,S=d[(0,f.getRowid)(e,x)],I=S?S.level:0,O=x[C],_=x[m];l.default.isArray(O)||(O=x[C]=[]),l.default.isArray(_)||(_=x[C]=[]),O[y](t),_[y](t);var E={row:t,rowid:h,seq:-1,index:-1,_index:-1,$index:-1,items:O,parent:x,level:I+1};c[h]=E,d[h]=E}else{0,o[y](t),n[y](t);var A={row:t,rowid:h,seq:-1,index:-1,_index:-1,$index:-1,items:n,parent:null,level:0};c[h]=A,d[h]=A}}))}function _(e,t,r,n){var o=e.tableFullTreeData,c=e.mergeList,d=e.afterFullData,h=e.editStore,w=e.tableFullData,m=e.treeConfig,C=e.fullDataRowIdData,y=e.fullAllDataRowIdData,R=e.treeOpts,S=R.transform,_=R.rowField,E=R.mapChildrenField,A=R.children||R.childrenField;l.default.isArray(t)||(t=[t]);var D=e.defineField(t.map((function(e){var t;return Object.assign(m&&S?(I(t={},E,[]),I(t,A,[]),t):{},e)})));if(l.default.eqNull(r))m&&S?O(e,D,!1):(d.unshift.apply(d,x(D)),w.unshift.apply(w,x(D)),c.forEach((function(e){var t=e.row;t>0&&(e.row=t+D.length)})));else if(-1===r)m&&S?O(e,D,!0):(d.push.apply(d,x(D)),w.push.apply(w,x(D)),c.forEach((function(e){var t=e.row,r=e.rowspan;t+r>d.length&&(e.rowspan=r+D.length)})));else if(m&&S){var F=l.default.findTree(o,(function(e){return r[_]===e[_]}),{children:E});if(F){var M=F.parent,T=M?M[E]:o,j=y[(0,f.getRowid)(e,M)],k=j?j.level:0;if(D.forEach((function(t,i){var r=(0,f.getRowid)(e,t);M&&(t[R.parentField]=M[_]);var l=F.index+i;n&&(l+=1),T.splice(l,0,t);var o={row:t,rowid:r,seq:-1,index:-1,_index:-1,$index:-1,items:T,parent:M,level:k+1};C[r]=o,y[r]=o})),M){var $=l.default.findTree(o,(function(e){return r[_]===e[_]}),{children:A});if($){var P=$.items,V=$.index;n&&(V+=1),P.splice.apply(P,[V,0].concat(x(D)))}}}else O(e,D,!0)}else{if(m)throw new Error((0,v.getLog)("vxe.error.noTree",["insert"]));var L=-1;if(l.default.isNumber(r)?r<d.length&&(L=r):L=e.findRowIndexOf(d,r),n&&(L=Math.min(d.length,L+1)),-1===L)throw new Error((0,v.errLog)("vxe.error.unableInsert"));d.splice.apply(d,[L,0].concat(x(D))),w.splice.apply(w,[e.findRowIndexOf(w,r),0].concat(x(D))),c.forEach((function(e){var t=e.row,r=e.rowspan;t>L?e.row=t+D.length:t+r>L&&(e.rowspan=r+D.length)}))}var B=h.insertList,Y=h.insertMaps;return D.forEach((function(t){var r=(0,f.getRowid)(e,t);Y[r]=t})),B.unshift.apply(B,x(D)),e.cacheRowMap(),e.updateScrollYStatus(),e.handleTableData(m&&S),m&&S||e.updateAfterDataIndex(),e.updateFooter(),e.checkSelectionStatus(),e.scrollYLoad&&e.updateScrollYSpace(),e.$nextTick().then((function(){return e.updateCellAreas(),e.recalculate()})).then((function(){return{row:D.length?D[D.length-1]:null,rows:D}}))}var E={methods:{_insert:function(e){return _(this,e,null)},_insertAt:function(e,t){return _(this,e,t)},_insertNextAt:function(e,t){return _(this,e,t,!0)},_remove:function(e){var t=this,r=this.afterFullData,n=this.tableFullData,o=this.tableFullTreeData,c=this.treeConfig,d=this.mergeList,h=this.editStore,v=this.checkboxOpts,w=this.selectCheckboxMaps,m=this.isInsertByRow,C=this.treeOpts,y=C.transform,x=C.mapChildrenField,S=C.children||C.childrenField,I=h.actived,O=h.removeList,_=h.insertList,E=h.insertMaps,A=v.checkField,D=[];if(e?l.default.isArray(e)||(e=[e]):e=n,e.forEach((function(e){m(e)||O.push(e)})),!A){var F=R({},w);e.forEach((function(e){var r=(0,f.getRowid)(t,e);F[r]&&delete F[r]})),this.selectCheckboxMaps=F}return n===e?(e=D=n.slice(0),this.tableFullData=[],this.afterFullData=[],this.clearMergeCells()):c&&y?e.forEach((function(e){var n=(0,f.getRowid)(t,e),c=l.default.findTree(o,(function(e){return n===(0,f.getRowid)(t,e)}),{children:x});if(c){var d=c.items.splice(c.index,1);D.push(d[0])}var h=l.default.findTree(o,(function(e){return n===(0,f.getRowid)(t,e)}),{children:S});h&&h.items.splice(h.index,1);var v=t.findRowIndexOf(r,e);v>-1&&r.splice(v,1)})):e.forEach((function(e){var l=t.findRowIndexOf(n,e);if(l>-1){var o=n.splice(l,1);D.push(o[0])}var c=t.findRowIndexOf(r,e);c>-1&&(d.forEach((function(e){var t=e.row,r=e.rowspan;t>c?e.row=t-1:t+r>c&&(e.rowspan=r-1)})),r.splice(c,1))})),I.row&&this.findRowIndexOf(e,I.row)>-1&&this.clearActived(),e.forEach((function(e){var r=(0,f.getRowid)(t,e),n=t.findRowIndexOf(_,e);n>-1&&_.splice(n,1),delete E[r]})),this.handleTableData(c&&y),c&&y||this.updateAfterDataIndex(),this.updateFooter(),this.cacheRowMap(),this.checkSelectionStatus(),this.scrollYLoad&&this.updateScrollYSpace(),this.$nextTick().then((function(){return t.updateCellAreas(),t.recalculate()})).then((function(){return{row:D.length?D[D.length-1]:null,rows:D}}))},_removeCheckboxRow:function(){var e=this;return this.remove(this.getCheckboxRecords()).then((function(t){return e.clearCheckboxRow(),t}))},_removeRadioRow:function(){var e=this,t=this.getRadioRecord();return this.remove(t||[]).then((function(t){return e.clearRadioRow(),t}))},_removeCurrentRow:function(){var e=this,t=this.getCurrentRecord();return this.remove(t||[]).then((function(t){return e.clearCurrentRow(),t}))},_getRecordset:function(){return{insertRecords:this.getInsertRecords(),removeRecords:this.getRemoveRecords(),updateRecords:this.getUpdateRecords(),pendingRecords:this.getPendingRecords()}},_getInsertRecords:function(){var e=this,t=this.fullAllDataRowIdData,r=this.editStore.insertList,n=[];return r.forEach((function(r){var l=(0,f.getRowid)(e,r);t[l]&&n.push(r)})),n},_getRemoveRecords:function(){return this.editStore.removeList},_getUpdateRecords:function(){var e=this.keepSource,t=this.tableFullData,r=this.isUpdateByRow,n=this.treeConfig,o=this.treeOpts,c=this.editStore;if(e){var d=c.actived,f=d.row,h=d.column;return(f||h)&&this._syncActivedCell(),n?l.default.filterTree(t,(function(e){return r(e)}),o):t.filter((function(e){return r(e)}))}return[]},handleActived:function(e,t){var r=this,n=this.editStore,l=this.editOpts,o=this.tableColumn,c=this.editConfig,f=this.mouseConfig,h=l.mode,v=n.actived,w=e.row,m=e.column,C=m.editRender,y=e.cell=e.cell||this.getCell(w,m),x=l.beforeEditMethod||l.activeMethod;if((0,d.isEnableConf)(c)&&(0,d.isEnableConf)(C)&&!this.hasPendingByRow(w)&&y){if(v.row!==w||"cell"===h&&v.column!==m){var S="edit-disabled";x&&!x(R(R({},e),{},{$table:this,$grid:this.$xegrid}))||(f&&(this.clearSelected(t),this.clearCellAreas(t),this.clearCopyCellArea(t)),this.closeTooltip(),v.column&&this.clearActived(t),S="edit-activated",m.renderHeight=y.offsetHeight,v.args=e,v.row=w,v.column=m,"row"===h?o.forEach((function(e){return r._getColumnModel(w,e)})):this._getColumnModel(w,m),this.$nextTick((function(){r.handleFocus(e,t)}))),this.emitEvent(S,{row:w,rowIndex:this.getRowIndex(w),$rowIndex:this.getVMRowIndex(w),column:m,columnIndex:this.getColumnIndex(m),$columnIndex:this.getVMColumnIndex(m)},t),"edit-activated"===S&&this.emitEvent("edit-actived",{row:w,rowIndex:this.getRowIndex(w),$rowIndex:this.getVMRowIndex(w),column:m,columnIndex:this.getColumnIndex(m),$columnIndex:this.getVMColumnIndex(m)},t)}else{var I=v.column;if(f&&(this.clearSelected(t),this.clearCellAreas(t),this.clearCopyCellArea(t)),I!==m){var O=I.model;O.update&&d.default.setCellValue(w,I,O.value),this.clearValidate()}m.renderHeight=y.offsetHeight,v.args=e,v.column=m,setTimeout((function(){r.handleFocus(e,t)}))}this.focus()}return this.$nextTick()},_getColumnModel:function(e,t){var r=t.model;t.editRender&&(r.value=d.default.getCellValue(e,t),r.update=!1)},_setColumnModel:function(e,t){var r=t.model;t.editRender&&r.update&&(d.default.setCellValue(e,t,r.value),r.update=!1,r.value=null)},_syncActivedCell:function(){var e=this,t=this.tableColumn,r=this.editStore,n=this.editOpts,l=r.actived,o=l.row,c=l.column;(o||c)&&("row"===n.mode?t.forEach((function(t){return e._setColumnModel(o,t)})):this._setColumnModel(o,c))},_clearActived:function(e){return this.clearEdit(e)},_clearEdit:function(e){var t=this.editStore.actived,r=t.row,n=t.column;return(r||n)&&(this._syncActivedCell(),t.args=null,t.row=null,t.column=null,this.updateFooter(),this.emitEvent("edit-closed",{row:r,rowIndex:this.getRowIndex(r),$rowIndex:this.getVMRowIndex(r),column:n,columnIndex:this.getColumnIndex(n),$columnIndex:this.getVMColumnIndex(n)},e)),"obsolete"===c.default.cellVaildMode&&this.clearValidate?this.clearValidate():this.$nextTick()},_getActiveRecord:function(){return this.getEditRecord()},_getEditRecord:function(){var e=this.$el,t=this.editStore,r=this.afterFullData,n=t.actived,l=n.args,o=n.row;return l&&this.findRowIndexOf(r,o)>-1&&e.querySelectorAll(".vxe-body--column.col--active").length?Object.assign({},l):null},_isActiveByRow:function(e){return this.isEditByRow(e)},_isEditByRow:function(e){return this.editStore.actived.row===e},handleFocus:function(e){var t=e.row,r=e.column,n=e.cell,c=r.editRender;if((0,d.isEnableConf)(c)){var f,v=o.default.renderer.get(c.name),w=c.autofocus,m=c.autoselect;if(!w&&v&&(w=v.autofocus),!m&&v&&(m=v.autoselect),l.default.isFunction(w)?f=w.call(this,e):w&&(f=n.querySelector(w))&&f.focus(),f){if(m)f.select();else if(h.browse.msie){var C=f.createTextRange();C.collapse(!1),C.select()}}else this.scrollToRow(t,r)}},_setActiveRow:function(e){return this.setEditRow(e)},_setEditRow:function(e,t){var r=l.default.find(this.visibleColumn,(function(e){return(0,d.isEnableConf)(e.editRender)}));return t&&(r=l.default.isString(t)?this.getColumnByField(t):t),this.setEditCell(e,r)},_setActiveCell:function(e){return this.setEditCell(e)},_setEditCell:function(e,t){var r=this,n=this.editConfig,o=l.default.isString(t)?this.getColumnByField(t):t;return e&&o&&(0,d.isEnableConf)(n)&&(0,d.isEnableConf)(o.editRender)?this.scrollToRow(e,!0).then((function(){var t=r.getCell(e,o);t&&(r.handleActived({row:e,rowIndex:r.getRowIndex(e),column:o,columnIndex:r.getColumnIndex(o),cell:t,$table:r}),r.lastCallTime=Date.now())})):this.$nextTick()},_setSelectCell:function(e,t){var r=this.tableData,n=this.editOpts,o=this.visibleColumn,c=l.default.isString(t)?this.getColumnByField(t):t;if(e&&c&&"manual"!==n.trigger){var d=this.findRowIndexOf(r,e);if(d>-1){var f=this.getCell(e,c),h={row:e,rowIndex:d,column:c,columnIndex:o.indexOf(c),cell:f};this.handleSelected(h,{})}}return this.$nextTick()},handleSelected:function(e,t){var r=this,n=this.mouseConfig,l=this.mouseOpts,o=this.editOpts,c=this.editStore,d=c.actived,f=c.selected,h=e.row,v=e.column,w=n&&l.selected;return!w||f.row===h&&f.column===v||(d.row!==h||"cell"===o.mode&&d.column!==v)&&(r.clearActived(t),r.clearSelected(t),r.clearCellAreas(t),r.clearCopyCellArea(t),f.args=e,f.row=h,f.column=v,w&&r.addColSdCls(),r.focus(),t&&r.emitEvent("cell-selected",e,t)),r.$nextTick()},_getSelectedCell:function(){var e=this.editStore.selected,t=e.args,r=e.column;return t&&r?Object.assign({},t):null},_clearSelected:function(){var e=this.editStore.selected;return e.row=null,e.column=null,this.reColTitleSdCls(),this.reColSdCls(),this.$nextTick()},reColTitleSdCls:function(){var e=this.elemStore["main-header-list"];e&&l.default.arrayEach(e.querySelectorAll(".col--title-selected"),(function(e){return h.default.removeClass(e,"col--title-selected")}))},reColSdCls:function(){var e=this.$el.querySelector(".col--selected");e&&h.default.removeClass(e,"col--selected")},addColSdCls:function(){var e=this.editStore.selected,t=e.row,r=e.column;if(this.reColSdCls(),t&&r){var n=this.getCell(t,r);n&&h.default.addClass(n,"col--selected")}}}};t.default=E}}]);